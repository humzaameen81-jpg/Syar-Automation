(self.webpackChunkautoma=self.webpackChunkautoma||[]).push([[3475],{32350:(e,t,a)=>{"use strict";function o(){return{}}a.d(t,{Z:()=>o})},83869:(e,t,a)=>{"use strict";a.d(t,{Z:()=>i,g:()=>n});const o=new(a(85334).ZP)("logs");o.version(1).stores({ctxData:"++id, logId",logsData:"++id, logId",histories:"++id, logId",items:"++id, name, endedAt, workflowId, status, collectionId"});const n={name:"",endedAt:0,message:"",startedAt:0,parentLog:null,workflowId:null,status:"success",collectionId:null},i=o},34983:(e,t,a)=>{"use strict";a.d(t,{Z:()=>r});var o=a(16483),n=a.n(o),i=a(97148),s=a.n(i);a(60446),a(1959),a(94121),a(68698),a(61266),a(48206),a(34399),a(9556),a(89127);n().extend(s());const r=n()},14776:(e,t,a)=>{"use strict";a.d(t,{Z:()=>i});var o=a(87360);const n=e=>"string"==typeof e.drawflow?(0,o.Rx)(e.drawflow,{}):e.drawflow;function i(e){const t=n(e);if(!t?.drawflow)return e;const a=(0,o.No)(t);if(!a)return e;const i=t.drawflow.Home.data,s=new Set,r=[],l=[];return function e(t){if(s.has(t))return;const a=i[t];r.push({id:a.id,type:a.html,label:a.name,position:{x:a.pos_x,y:a.pos_y},data:a.data});const o=[],n=Object.values(a.outputs);n.forEach((({connections:e},t)=>{let i=t+1;const s=n.length-1===t,r="conditions"===a.name,c="BlockBasicWithFallback"===a.html,d="BlockBasic"===a.html&&i>=2;(r||c||d)&&s&&(i="fallback"),r&&!s&&(i=a.data.conditions[t].id),e.forEach((({node:e,output:t})=>{const n=`${a.id}-output-${i}`,s=`${e}-${t.replace("_","-")}`;l.push({sourceHandle:n,targetHandle:s,source:a.id,target:e,updatable:!0,selectable:!0,id:`vueflow__edge-${n}-${s}`,class:`source-${n} target-${s}`}),o.push(e)}))})),s.add(t),o.forEach((t=>{e(t)}))}(a.id),e.drawflow={edges:l,nodes:r,x:0,y:0,zoom:0},e}},64413:(e,t,a)=>{"use strict";a.d(t,{Z:()=>h});var o=a(57735),n=a.n(o),i=a(71947),s=a.n(i),r=a(72726),l=a.n(r),c=a(26551),d=a.n(c),u=a(67812),p=a(87360);const h={encrypt:function(e){const t=(0,u.Z)("credential"),a=l().encrypt(e,t).toString();return s()(a,n()(t)).toString()+a},decrypt:function(e){const t=(0,u.Z)("credential"),a=e.substring(0,64),o=e.substring(64);if(a!==s()(o,n()(t)).toString())return"";const i=l().decrypt(o,t).toString(d());return(0,p.Rx)(i,i)}}},99137:(e,t,a)=>{"use strict";a.d(t,{Z:()=>n});var o=a(37576);function n({message:e,...t}){const a=o.default.log.messages[e];return a?a({normalize:e=>e.join(""),interpolate:e=>t[e],named:e=>e}):e}},67812:(e,t,a)=>{"use strict";function o(){return"yd-automa-dev"}a.d(t,{Z:()=>o})},81102:(e,t,a)=>{"use strict";a.d(t,{V:()=>n});var o=a(57692);function n(){return{...o.wq}}},57692:(e,t,a)=>{"use strict";a.d(t,{ND:()=>i,YK:()=>n,wq:()=>o});const o={trigger:{name:"Trigger",description:"Block where workflow will start executing",icon:"riFlashlightLine",component:"BlockBasic",editComponent:"EditTrigger",category:"general",inputs:0,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["url"],data:{disableBlock:!1,description:"",type:"manual",interval:60,delay:5,date:"",time:"00:00",url:"",shortcut:"",activeInInput:!1,isUrlRegex:!1,days:[],contextMenuName:"",contextTypes:[],parameters:[],preferParamsInTab:!1,observeElement:{selector:"",baseSelector:"",matchPattern:"",targetOptions:{subtree:!1,childList:!0,attributes:!1,attributeFilter:[],characterData:!1},baseElOptions:{subtree:!1,childList:!0,attributes:!1,attributeFilter:[],characterData:!1}}}},"ai-workflow":{name:"AI Workflow",description:"A workflow that is created by AI-Power",icon:"https://winrobot-pub-a-1302949341.cos.ap-shanghai.myqcloud.com/image/20250717194249/10e0c06a7b243d15ac9a9385b07ce4e2.svg",tag:"AI",component:"BlockBasic",editComponent:"EditAiWorkflow",category:"general",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,data:{disableBlock:!1,flowUuid:"",flowLabel:"",description:"",inputs:[],outputs:[],assignVariable:!1,variableName:"",saveData:!1,dataColumn:""}},"execute-workflow":{name:"Execute workflow",description:"",icon:"riFlowChart",component:"BlockBasic",category:"general",editComponent:"EditExecuteWorkflow",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["globalData"],data:{disableBlock:!1,executeId:"",workflowId:"",globalData:"",description:"",insertAllVars:!1,insertAllGlobalData:!1}},"active-tab":{name:"Active tab",description:"Set current tab that you're in as an active tab",icon:"riWindowLine",component:"BlockBasic",category:"browser",disableEdit:!0,inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,data:{disableBlock:!1}},"new-tab":{name:"New tab",description:"Create a new tab",icon:"riGlobalLine",component:"BlockBasic",editComponent:"EditNewTab",category:"browser",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["url","userAgent"],data:{disableBlock:!1,description:"",url:"",userAgent:"",active:!0,tabZoom:1,inGroup:!1,waitTabLoaded:!1,updatePrevTab:!1,customUserAgent:!1}},"switch-tab":{name:"Switch tab",description:"Switch active tab",icon:"riArrowLeftRightLine",component:"BlockBasic",editComponent:"EditSwitchTab",category:"browser",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["url","matchPattern","tabTitle"],data:{disableBlock:!1,description:"",url:"",tabIndex:0,tabTitle:"",matchPattern:"",activeTab:!0,createIfNoMatch:!1,findTabBy:"match-patterns"}},"new-window":{name:"New window",description:"Create a new window",icon:"riWindow2Line",component:"BlockBasic",editComponent:"EditNewWindow",category:"browser",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["url"],data:{disableBlock:!1,description:"",top:0,left:0,width:0,url:"",height:0,type:"normal",incognito:!1,windowState:"normal"}},proxy:{name:"Proxy",description:"Set the proxy of the browser",icon:"riShieldKeyholeLine",component:"BlockBasic",category:"browser",editComponent:"EditProxy",inputs:1,outputs:1,maxConnection:1,allowedInputs:!0,refDataKeys:["host","port","scheme"],data:{description:"",disableBlock:!1,scheme:"https",host:"",port:443,bypassList:"",clearProxy:!1}},"go-back":{name:"Go back",description:"Go back to the previous page",icon:"riArrowGoBackLine",component:"BlockBasic",category:"browser",inputs:1,outputs:1,maxConnection:1,disableEdit:!0,allowedInputs:!0,data:{disableBlock:!1}},"forward-page":{name:"Go forward",description:"Go forward to the next page",icon:"riArrowGoForwardLine",component:"BlockBasic",category:"browser",inputs:1,outputs:1,maxConnection:1,disableEdit:!0,allowedInputs:!0,data:{disableBlock:!1}},"close-tab":{name:"Close tab/window",icon:"riCloseCircleLine",component:"BlockBasic",category:"browser",editComponent:"EditCloseTab",inputs:1,outputs:1,maxConnection:1,allowedInputs:!0,refDataKeys:["url"],data:{disableBlock:!1,url:"",description:"",activeTab:!0,closeType:"tab",allWindows:!1}},"take-screenshot":{name:"Take screenshot",description:"Take a screenshot of current active tab",icon:"riImageLine",component:"BlockBasic",category:"browser",editComponent:"EditTakeScreenshot",inputs:1,outputs:1,maxConnection:1,allowedInputs:!0,refDataKeys:["fileName","selector","variableName"],autocomplete:["variableName"],data:{description:"",disableBlock:!1,fileName:"",ext:"png",quality:100,dataColumn:"",variableName:"",selector:"",fullPage:!1,saveToColumn:!1,saveToComputer:!0,assignVariable:!1,captureActiveTab:!0}},"browser-event":{name:"Browser event",description:"Wait until the selected event is triggered",icon:"riLightbulbLine",component:"BlockBasic",category:"browser",editComponent:"EditBrowserEvent",inputs:1,outputs:1,maxConnection:1,allowedInputs:!0,data:{disableBlock:!1,description:"",timeout:1e4,eventName:"tab:loaded",setAsActiveTab:!0,activeTabLoaded:!0,tabLoadedUrl:"",tabUrl:"",fileQuery:""}},"event-click":{name:"Click element",icon:"riCursorLine",component:"BlockBasic",editComponent:"EditInteractionBase",category:"interaction",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["selector"],data:{disableBlock:!1,description:"",findBy:"cssSelector",waitForSelector:!1,waitSelectorTimeout:5e3,selector:"",markEl:!1,multiple:!1}},delay:{name:"Delay",description:"Add delay before executing the next block",icon:"riTimerLine",component:"BlockDelay",editComponent:"EditDelay",category:"general",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["time"],data:{disableBlock:!1,time:500}},"get-text":{name:"Get text",description:"Get text from an element",icon:"riParagraph",component:"BlockBasic",editComponent:"EditGetText",category:"interaction",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["selector","variableName","prefixText","suffixText","extraRowValue"],autocomplete:["variableName"],data:{disableBlock:!1,description:"",findBy:"cssSelector",waitForSelector:!1,waitSelectorTimeout:5e3,selector:"",markEl:!1,multiple:!1,regex:"",prefixText:"",suffixText:"",regexExp:[],dataColumn:"",saveData:!0,includeTags:!1,addExtraRow:!1,assignVariable:!1,useTextContent:!1,variableName:"",extraRowValue:"",extraRowDataColumn:""}},"export-data":{name:"Export data",icon:"riDownloadLine",component:"BlockBasic",editComponent:"EditExportData",category:"general",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["name","variableName"],data:{disableBlock:!1,name:"",refKey:"",type:"json",description:"",variableName:"",csvDelimiter:",",addBOMHeader:!0,onConflict:"uniquify",dataToExport:"data-columns"}},"element-scroll":{name:"Scroll element",icon:"riMouseLine",component:"BlockBasic",editComponent:"EditScrollElement",category:"interaction",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["selector"],data:{disableBlock:!1,description:"",findBy:"cssSelector",waitForSelector:!1,waitSelectorTimeout:5e3,selector:"html",markEl:!1,multiple:!1,scrollY:0,scrollX:0,incX:!1,incY:!1,smooth:!1,scrollIntoView:!1}},link:{name:"Link",description:"Open link element",icon:"riLink",component:"BlockBasic",editComponent:"EditLink",category:"interaction",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["selector"],data:{disableBlock:!1,description:"",findBy:"cssSelector",waitForSelector:!1,waitSelectorTimeout:5e3,selector:"",markEl:!1,disableMultiple:!0,openInNewTab:!1}},"attribute-value":{name:"Attribute value",description:"Get attribute value of an element",icon:"riBracketsLine",component:"BlockBasic",editComponent:"EditAttributeValue",category:"interaction",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["selector","variableName","attributeName","extraRowValue","attributeValue"],autocomplete:["variableName"],data:{disableBlock:!1,description:"",findBy:"cssSelector",waitForSelector:!1,waitSelectorTimeout:5e3,selector:"",markEl:!1,multiple:!1,attributeValue:"",attributeName:"",assignVariable:!1,variableName:"",dataColumn:"",saveData:!0,action:"get",addExtraRow:!1,extraRowValue:"",extraRowDataColumn:""}},forms:{name:"Forms",icon:"riInputCursorMove",description:"Manipulate form(input, select, checkbox, and radio) element",component:"BlockBasic",editComponent:"EditForms",category:"interaction",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["selector","variableName","value","optionPosition","delay"],autocomplete:["variableName"],data:{disableBlock:!1,description:"",findBy:"cssSelector",waitForSelector:!1,waitSelectorTimeout:5e3,selector:"",markEl:!1,multiple:!1,selected:!0,clearValue:!0,getValue:!1,saveData:!1,dataColumn:"",selectOptionBy:"value",optionPosition:"1",assignVariable:!1,variableName:"",type:"text-field",value:"",delay:0,events:[]}},"repeat-task":{name:"Repeat task",icon:"riRepeat2Line",component:"BlockRepeatTask",category:"conditions",inputs:1,outputs:2,allowedInputs:!0,maxConnection:1,refDataKeys:["repeatFor"],data:{disableBlock:!1,repeatFor:"1"}},"javascript-code":{name:"JavaScript code",description:"Execute your custom javascript code in a webpage",icon:"riCodeSSlashLine",component:"BlockBasic",editComponent:"EditJavascriptCode",category:"interaction",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,data:{disableBlock:!1,description:"",timeout:2e4,context:"website",code:'console.log("Hello world!");\nautomaNextBlock()',preloadScripts:[],everyNewTab:!1,runBeforeLoad:!1}},"trigger-event":{name:"Trigger event",description:"Trigger event",icon:"riLightbulbFlashLine",component:"BlockBasic",editComponent:"EditTriggerEvent",category:"interaction",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["selector","eventParams.clientX","eventParams.clientY"],data:{disableBlock:!1,description:"",findBy:"cssSelector",waitForSelector:!1,waitSelectorTimeout:5e3,selector:"html",markEl:!1,multiple:!1,eventName:"",eventType:"",eventParams:{bubbles:!0,cancelable:!1}}},"google-sheets":{name:"Google sheets",description:"Read Google Sheets data",icon:"mdiGoogleSheet",component:"BlockBasic",editComponent:"EditGoogleSheets",category:"onlineServices",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["customData","range","spreadsheetId","variableName"],autocomplete:["refKey"],data:{disableBlock:!1,range:"",refKey:"",type:"get",customData:"",description:"",spreadsheetId:"",dataColumn:"",saveData:!0,assignVariable:!1,variableName:"",firstRowAsKey:!1,keysAsFirstRow:!0,valueInputOption:"RAW",InsertDataOption:"INSERT_ROWS",dataFrom:"data-columns"}},"google-sheets-drive":{name:"Google sheets (GDrive)",description:"Read Google Sheets data",icon:"riDriveFill",component:"BlockBasic",editComponent:"EditGoogleSheetsDrive",category:"onlineServices",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["customData","range","spreadsheetId","sheetName","variableName"],autocomplete:["refKey"],data:{disableBlock:!1,range:"",refKey:"",type:"get",customData:"",description:"",spreadsheetId:"",dataColumn:"",inputSpreadsheetId:"connected",saveData:!0,sheetName:"",assignVariable:!1,variableName:"",firstRowAsKey:!1,keysAsFirstRow:!0,valueInputOption:"RAW",InsertDataOption:"INSERT_ROWS",dataFrom:"data-columns"}},"google-drive":{name:"Google drive",description:"Upload files to Google Drive",icon:"riDriveLine",component:"BlockBasic",editComponent:"EditGoogleDrive",category:"onlineServices",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:[],autocomplete:["refKey"],data:{disableBlock:!1,action:"upload",filePaths:[]}},conditions:{name:"Conditions",description:"Conditional block",icon:"riAB",component:"BlockConditions",editComponent:"EditConditions",category:"conditions",inputs:1,outputs:0,allowedInputs:!0,maxConnection:1,data:{description:"",disableBlock:!1,conditions:[],retryConditions:!1,retryCount:10,retryTimeout:1e3}},"element-exists":{name:"Element exists",description:"Check if an element is exists",icon:"riFocus3Line",component:"BlockElementExists",editComponent:"EditElementExists",category:"conditions",inputs:1,outputs:2,allowedInputs:!0,maxConnection:1,refDataKeys:["selector"],data:{disableBlock:!1,description:"",findBy:"cssSelector",selector:"",tryCount:1,timeout:500,markEl:!1,throwError:!1}},webhook:{name:"HTTP Request",description:"make an HTTP request",icon:"riEarthLine",component:"BlockBasicWithFallback",editComponent:"EditWebhook",category:"general",inputs:1,outputs:2,allowedInputs:!0,maxConnection:1,refDataKeys:["body","url","variableName"],autocomplete:["variableName"],data:{disableBlock:!1,description:"",url:"",body:"{}",headers:[],method:"POST",timeout:1e4,dataPath:"",contentType:"json",variableName:"",assignVariable:!1,saveData:!1,dataColumn:"",responseType:"json"}},"while-loop":{name:"While loop",description:"Execute blocks while the condition is met",icon:"riRefreshFill",component:"BlockBasicWithFallback",editComponent:"EditWhileLoop",category:"conditions",inputs:1,outputs:2,allowedInputs:!0,maxConnection:1,data:{disableBlock:!1,description:"",conditions:null}},"loop-data":{name:"Loop data",icon:"riRefreshLine",component:"BlockBasic",editComponent:"EditLoopData",category:"conditions",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["maxLoop","loopData","selector","startIndex","variableName","referenceKey","elementSelector"],autocomplete:["variableName","loopId"],data:{disableBlock:!1,loopId:"",maxLoop:0,toNumber:10,fromNumber:1,startIndex:0,loopData:"[]",description:"",variableName:"",referenceKey:"",reverseLoop:!1,elementSelector:"",waitForSelector:!1,waitSelectorTimeout:5e3,resumeLastWorkflow:!1,loopThrough:"data-columns"}},"loop-elements":{name:"Loop elements",icon:"riRestartLine",component:"BlockBasic",editComponent:"EditLoopElements",category:"conditions",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["maxLoop","selector","variableName","elementSelector","actionElSelector"],autocomplete:["loopId"],data:{disableBlock:!1,loopId:"",selector:"",maxLoop:"0",description:"",reverseLoop:!1,actionElSelector:"",findBy:"cssSelector",actionElMaxWaitTime:5,actionPageMaxWaitTime:10,loadMoreAction:"none",scrollToBottom:!0,waitForSelector:!1,waitSelectorTimeout:5e3}},"loop-breakpoint":{name:"Loop breakpoint",description:"To tell where loop data must stop",icon:"riStopLine",component:"BlockLoopBreakpoint",category:"conditions",disableEdit:!0,inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,data:{disableBlock:!1,loopId:"",clearLoop:!1}},"blocks-group":{name:"Blocks group",description:"Grouping blocks",icon:"riFolderZipLine",component:"BlockGroup",category:"general",disableEdit:!0,inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,data:{disableBlock:!1,name:"",blocks:[]}},clipboard:{name:"Clipboard",description:"Get the copied text from the clipboard",icon:"riClipboardLine",component:"BlockBasic",category:"general",editComponent:"EditClipboard",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,autocomplete:["variableName"],refDataKeys:["dataToCopy","variableName"],data:{disableBlock:!1,description:"",type:"get",assignVariable:!1,variableName:"",saveData:!0,dataColumn:"",dataToCopy:"",copySelectedText:!1}},"insert-data":{name:"Insert data",description:"Insert data into table or variable",icon:"riDatabase2Line",component:"BlockBasic",category:"data",editComponent:"EditInsertData",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,data:{disableBlock:!1,description:"",dataList:[]}},"switch-to":{name:"Switch frame",description:"Switch between main window and iframe",icon:"riArrowUpDownLine",component:"BlockBasic",editComponent:"EditSwitchTo",category:"interaction",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["selector"],data:{disableBlock:!1,findBy:"cssSelector",selector:"",windowType:"main-window"}},"upload-file":{name:"Upload file",description:'Upload file into <input type="file"> element',icon:"riFileUploadLine",component:"BlockBasic",editComponent:"EditUploadFile",category:"interaction",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["selector","filePaths"],data:{disableBlock:!1,findBy:"cssSelector",waitForSelector:!1,waitSelectorTimeout:5e3,selector:"",filePaths:[]}},"hover-element":{name:"Hover element",description:"Hover over an element",icon:"mdiCursorDefaultClickOutline",component:"BlockBasic",editComponent:"EditInteractionBase",category:"interaction",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["selector"],data:{disableBlock:!1,description:"",findBy:"cssSelector",waitForSelector:!1,waitSelectorTimeout:5e3,selector:"",markEl:!1,multiple:!1}},"save-assets":{name:"Save assets",description:"Save assets (image, video, audio, or file) from an element or URL",icon:"riImageLine",component:"BlockBasic",editComponent:"EditSaveAssets",category:"interaction",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["selector","url","filename","variableName"],data:{disableBlock:!1,description:"",findBy:"cssSelector",waitForSelector:!1,waitSelectorTimeout:5e3,selector:"",markEl:!1,multiple:!1,type:"element",url:"",filename:"",saveDownloadIds:!1,onConflict:"uniquify",dataColumn:"",saveData:!0,assignVariable:!1,variableName:"",saveToGDrive:!1}},"press-key":{name:"Press key",description:"Press a key or a combination",icon:"riKeyboardLine",component:"BlockBasic",editComponent:"EditPressKey",category:"interaction",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["selector","keys","keysToPress","pressTime"],data:{disableBlock:!1,keys:"",selector:"",pressTime:"0",description:"",keysToPress:"",action:"press-key"}},"handle-dialog":{name:"Handle dialog",description:"Accepts or dismisses a JavaScript initiated dialog (alert, confirm, prompt, or onbeforeunload).",icon:"riChat3Line",component:"BlockBasic",editComponent:"EditHandleDialog",category:"browser",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["promptText"],data:{disableBlock:!1,description:"",accept:!0,promptText:""}},"handle-download":{name:"Handle download",description:"Handle downloaded file",icon:"riFileDownloadLine",component:"BlockBasic",editComponent:"EditHandleDownload",category:"browser",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["filename","downloadId","variableName"],autocomplete:["variableName"],data:{disableBlock:!1,description:"",filename:"",timeout:2e4,onConflict:"uniquify",waitForDownload:!0,dataColumn:"",saveData:!0,assignVariable:!1,variableName:"",downloadId:""}},"reload-tab":{name:"Reload tab",description:"Reload the active tab",icon:"riRestartLine",component:"BlockBasic",category:"browser",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,disableEdit:!0,data:{disableBlock:!1}},"delete-data":{name:"Delete data",description:"Delete table or variable data",icon:"riDeleteBin7Line",editComponent:"EditDeleteData",component:"BlockBasic",category:"data",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,data:{disableBlock:!1,description:"",deleteList:[]}},"wait-connections":{name:"Wait connections",description:"Wait for all connections before continuing to the next block",icon:"riTimerFlashLine",editComponent:"EditWaitConnections",component:"BlockBasic",category:"general",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,data:{disableBlock:!1,description:"",timeout:1e4,specificFlow:!1,flowBlockId:""}},notification:{name:"Notification",description:"Display a notification",icon:"riNotification3Line",editComponent:"EditNotification",component:"BlockBasic",category:"general",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["message","title","iconUrl","imageUrl"],data:{disableBlock:!1,description:"",message:"",iconUrl:"",imageUrl:"",title:"Hello world!"}},"log-data":{name:"Get log data",description:"Get the latest log data of a workflow",icon:"riFileHistoryLine",editComponent:"EditLogData",component:"BlockBasic",category:"data",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,data:{disableBlock:!1,description:"",workflowId:"",dataColumn:"",saveData:!0,assignVariable:!1,variableName:""}},"tab-url":{name:"Get tab URL",description:"Get the tab URL",icon:"riLinksLine",editComponent:"EditTabURL",component:"BlockBasic",category:"browser",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["variableName"],data:{disableBlock:!1,description:"",type:"active-tab",dataColumn:"",saveData:!0,assignVariable:!1,variableName:"",qTitle:"",qMatchPatterns:""}},"slice-variable":{name:"Slice variable",description:"Extracts a section of a variable value",icon:"riSliceLine",editComponent:"EditSliceVariable",component:"BlockBasic",category:"data",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,data:{disableBlock:!1,description:"",endIdxEnabled:!1,startIdxEnabled:!0,endIndex:0,startIndex:0,variableName:""}},"increase-variable":{name:"Increase variable",description:"Increase the value of a variable by specific amount",icon:"riIncreaseDecreaseLine",editComponent:"EditIncreaseVariable",component:"BlockBasic",category:"data",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,data:{disableBlock:!1,description:"",increaseBy:1,variableName:""}},"regex-variable":{name:"RegEx variable",description:"Matching a variable value against a regular expression",icon:"mdiRegex",editComponent:"EditRegexVariable",component:"BlockBasic",category:"data",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["replaceVal"],data:{disableBlock:!1,method:"match",replaceVal:"",description:"",expression:"",flag:[]}},"data-mapping":{name:"Data mapping",description:"Map data of a variable or table",icon:"riMindMap",editComponent:"EditDataMapping",component:"BlockBasic",category:"data",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,data:{disableBlock:!1,description:"",dataSource:"table",sources:[],varSourceName:"",dataColumn:"",saveData:!1,assignVariable:!1,variableName:""}},"sort-data":{name:"Sort data",description:"Sort the items of data",icon:"riSortAsc",editComponent:"EditSortData",component:"BlockBasic",category:"data",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,data:{disableBlock:!1,description:"",sortByProperty:!1,itemProperties:[],dataSource:"table",varSourceName:"",dataColumn:"",saveData:!1,assignVariable:!1,variableName:""}},"create-element":{name:"Create element",description:"Create an element and insert it into the page",icon:"riHtml5Line",editComponent:"EditCreateElement",component:"BlockBasic",category:"interaction",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["html","css","selector"],data:{disableBlock:!1,description:"",javascript:"",html:"",css:"",preloadScripts:[],findBy:"cssSelector",insertAt:"after",runBeforeLoad:!1,waitForSelector:!1,waitSelectorTimeout:5e3,selector:"body"}},cookie:{name:"Cookie",description:"Get, set, or remove cookies",icon:"mdiCookieOutline",editComponent:"EditCookie",component:"BlockBasic",category:"browser",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["domain","expirationDate","path","sameSite","name","url","value","jsonCode","variableName"],data:{disableBlock:!1,description:"",type:"get",jsonCode:"{\n\n}",useJson:!1,getAll:!1,domain:"",expirationDate:"",path:"",sameSite:"",name:"",url:"",value:"",httpOnly:!1,secure:!1,session:!1,assignVariable:!1,variableName:"",saveData:!0,dataColumn:""}},"block-package":{name:"Block package",description:"Block package",icon:"riHtml5Line",editComponent:"EditPackage",component:"BlockPackage",category:"package",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,data:{}},note:{name:"Note",description:"",icon:"riFileEditLine",component:"BlockNote",category:"general",disableEdit:!0,inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,data:{disableBlock:!1,note:"",drawing:!1,width:280,height:168,color:"white",fontSize:"regular"}},"workflow-state":{name:"Workflow State",description:"Manage workflows states",icon:"riSettings3Line",component:"BlockBasic",editComponent:"EditWorkflowState",category:"general",inputs:1,outputs:1,allowedInputs:!0,maxConnection:1,refDataKeys:["errorMessage"],data:{disableBlock:!1,description:"",type:"stop-current",exceptCurrent:!1,workflowsToStop:[],throwError:!1,errorMessage:""}},"parameter-prompt":{name:"Parameter prompt",description:"",icon:"riCommandLine",component:"BlockBasic",category:"general",editComponent:"EditParameterPrompt",inputs:1,outputs:1,maxConnection:1,allowedInputs:!0,data:{disableBlock:!1,description:"",timeout:6e4,parameters:[]}}},n={valueTypes:[{id:"value",category:"value",name:"Value",compareable:!0,data:{value:""}},{id:"code",category:"value",name:"Code",compareable:!1,data:{code:"\nreturn true;",context:"background"}},{id:"data#exists",category:"value",name:"Data exists",compareable:!1,valueKey:"dataPath",data:{dataPath:""}},{id:"element#text",category:"element",name:"Element text",compareable:!0,data:{selector:""}},{id:"element#exists",category:"element",name:"Element exists",compareable:!1,data:{selector:""}},{id:"element#notExists",category:"element",name:"Element not exists",compareable:!1,data:{selector:""}},{id:"element#visible",category:"element",name:"Element visible",compareable:!1,data:{selector:""}},{id:"element#visibleScreen",category:"element",name:"Element visible in screen",compareable:!1,data:{selector:""}},{id:"element#invisible",category:"element",name:"Element hidden in screen",compareable:!1,data:{selector:""}},{id:"element#attribute",category:"element",name:"Element attribute value",compareable:!0,data:{selector:"",attrName:""}}],compareTypes:[{id:"eq",name:"Equals",needValue:!0,category:"basic"},{id:"eqi",name:"Equals (case insensitive)",needValue:!0,category:"basic"},{id:"nq",name:"Not equals",needValue:!0,category:"basic"},{id:"gt",name:"Greater than",needValue:!0,category:"number"},{id:"gte",name:"Greater than or equal",needValue:!0,category:"number"},{id:"lt",name:"Less than",needValue:!0,category:"number"},{id:"lte",name:"Less than or equal",needValue:!0,category:"number"},{id:"cnt",name:"Contains",needValue:!0,category:"text"},{id:"cni",name:"Contains (case insensitive)",needValue:!0,category:"text"},{id:"nct",name:"Not contains",needValue:!0,category:"text"},{id:"nci",name:"Not contains (case insensitive)",needValue:!0,category:"text"},{id:"stw",name:"Starts with",needValue:!0,category:"text"},{id:"enw",name:"Ends with",needValue:!0,category:"text"},{id:"rgx",name:"Match with RegEx",needValue:!0,category:"text"},{id:"itr",name:"Is truthy",needValue:!1,category:"boolean"},{id:"ifl",name:"Is falsy",needValue:!1,category:"boolean"}],inputTypes:{selector:{placeholder:".class",label:"CSS selector or XPath"},value:{label:"Value",placeholder:"abc123"},attrName:{label:"Attribute name",placeholder:"name"},dataPath:{label:"variables@variableName",placeholder:""}}},i=["no-tab","invalid-active-tab","no-match-tab","invalid-body","element-not-found"]},49525:(e,t,a)=>{"use strict";a.d(t,{Z:()=>g});var o=a(79911),n=a(28875),i=a(9044),s=a(81102),r=a(87360),l=a(92323),c=a.n(l),d=a(67197),u=a(72112),p=a(81843),h=a.n(p),m=a(87491);const w=class{constructor(e,t,a={}){this.id=e,this.engine=t,this.settings=t.workflow.settings,this.blocksDetail=a.blocksDetail||{},this.loopEls=[],this.loopList={},this.repeatedTasks={},this.preloadScripts=[],this.breakpointState=null,this.windowId=null,this.currentBlock=null,this.childWorkflowId=null,this.debugAttached=!1,this.activeTab={url:"",frameId:0,frames:{},groupId:null,id:t.options?.tabId}}init({blockId:e,execParam:t,state:a}){a&&Object.keys(a).forEach((e=>{this[e]=a[e]}));const o=this.engine.blocks[e];this.executeBlock(o,t)}addDataToColumn(e,t){if(Array.isArray(e))return void e.forEach((e=>{(0,r.Kn)(e)&&Object.entries(e).forEach((([e,t])=>{this.addDataToColumn(e,t)}))}));const a=this.settings.insertDefaultColumn??!0,o=(this.engine.columns[e]?e:this.engine.columnsId[e])||"column";if("column"===o&&!a)return;const n=this.engine.columns[o],i=n.name||"column",s=(0,u.fs)(t,n.type);(0,r.aX)(this.engine.referenceData.table,n.index)?this.engine.referenceData.table[n.index][i]=s:this.engine.referenceData.table.push({[i]:s}),n.index+=1}async setVariable(e,t){let a=e;const n=this.engine.referenceData.variables;if(e.startsWith("$push:")){const{1:o}=e.split("$push:");(0,r.aX)(n,o)?Array.isArray(n[o])||(n[o]=[n[o]]):n[o]=[],n[o].push(t),a=o}else n[e]=t;if(a.startsWith("$$")){a=a.slice(2);const e=await o.Z.variables.get({name:a});e?await o.Z.variables.update(e.id,{value:t}):await o.Z.variables.add({name:a,value:t})}this.engine.addRefDataSnapshot("variables")}getBlockConnections(e,t=1){if(this.engine.isDestroyed)return null;const a=`${e}-output-${t}`,o=this.engine.connectionsMap[a];return o?[...o.values()]:null}executeNextBlocks(e,t,a=null){for(const t of e){const e="string"==typeof t?t:t.id,o=this.engine.blocks[e];if(!o)return console.error(`Block ${e} doesn't exist`),void this.engine.destroy("stopped");o.data.disableBlock||o.data?.$breakpoint&&(a=0)}e.forEach(((e,o)=>{const{id:n,targetHandle:i,sourceHandle:s}="string"==typeof e?{id:e,targetHandle:"",sourceHandle:""}:e,r={prevBlockData:t,targetHandle:i,sourceHandle:s,nextBlockBreakpointCount:a};if(0===o)this.executeBlock(this.engine.blocks[n],{prevBlockData:t,...r});else{const e=c()({windowId:this.windowId,loopList:this.loopList,activeTab:this.activeTab,currentBlock:this.currentBlock,repeatedTasks:this.repeatedTasks,preloadScripts:this.preloadScripts,debugAttached:this.debugAttached});this.engine.addWorker({state:e,execParam:r,blockId:n})}}))}resume(e){if(!this.breakpointState)return;const{block:t,execParam:a,isRetry:o}=this.breakpointState,n={...a,resume:!0};n.nextBlockBreakpointCount=e?1:null,this.executeBlock(t,n,o),this.breakpointState=null}async executeBlock(e,t={},a=!1){const o=await this.engine.states.get(this.engine.id);if(!o||o.isDestroyed){if(this.engine.isDestroyed)return;return void await this.engine.destroy("stopped")}const n=Date.now(),i=this.currentBlock;this.currentBlock={...e,startedAt:n};const s=this.engine.isTestingMode&&(e.data?.$breakpoint&&!t.resume||0===t.nextBlockBreakpointCount);if(!a){const e={activeTabUrl:this.activeTab.url,childWorkflowId:this.childWorkflowId,nextBlockBreakpoint:Boolean(t.nextBlockBreakpointCount)};s&&"breakpoint"!==o.status&&(e.status="breakpoint"),await this.engine.updateState(e)}if(t.nextBlockBreakpointCount&&(t.nextBlockBreakpointCount-=1),s||"breakpoint"===o.status)return this.engine.isInBreakpoint=!0,void(this.breakpointState={block:e,execParam:t,isRetry:a});const l=this.engine.blocksHandler[(0,r.zW)(e.label)],d=l||"interaction"!==this.blocksDetail[e.label].category?l:this.engine.blocksHandler.interactionBlock;if(!d)return console.error(`${e.label} doesn't have handler`),void this.engine.destroy("stopped");const{prevBlockData:u}=t,p={prevBlockData:u,...this.engine.referenceData,activeTabUrl:this.activeTab.url},w=await async function({block:e,refKeys:t,data:a,isPopup:o}){if(!t||0===t.length)return e;const n=c()(e),i=e=>{n.replacedValue||(n.replacedValue={}),n.replacedValue={...n.replacedValue,...e}};for(const e of t){const t=h().get(n.data,e);if(t)if(Array.isArray(t))for(let s=0;s<t.length;s+=1){const r=t[s],l=await(0,m.Z)(r,a,o);i(l.list),h().set(n.data,`${e}.${s}`,l.value)}else if("string"==typeof t){const s=await(0,m.Z)(t,a,o);i(s.list),h().set(n.data,e,s.value)}}return n}({block:e,data:p,isPopup:this.engine.isPopup,refKeys:a||e.data.disableBlock?null:this.blocksDetail[e.label].refDataKeys}),f=this.settings?.blockDelay||0,b=(t,a={})=>{let{description:o}=e.data;"loop-breakpoint"===e.label?o=e.data.loopId:"block-package"===e.label&&(o=e.data.name),this.engine.addLogHistory({description:o,prevBlockData:u,type:t,name:e.label,blockId:e.id,workerId:this.id,timestamp:n,activeTabUrl:this.activeTab?.url,replacedValue:w.replacedValue,duration:Math.round(Date.now()-n),...a})},g=(e,a)=>this.executeNextBlocks(e,a,t.nextBlockBreakpointCount);try{let a;if(e.data.disableBlock)a={data:"",nextBlockId:this.getBlockConnections(e.id)};else{const o=d.bind(this,w,{refData:p,prevBlock:i,...t||{}});if(a=await function(e,t){return new Promise(((a,o)=>{let n=null;const i=t?.settings?.blockTimeout;i&&i>0&&(n=setTimeout((()=>{o(new Error("Timeout"))}),i)),e().then((e=>{a(e)})).catch((e=>{o(e)})).finally((()=>{n&&clearTimeout(n)}))}))}(o,e.data),this.engine.isDestroyed)return;a.replacedValue&&(w.replacedValue=a.replacedValue),b(a.status||"success",{logId:a.logId,ctxData:a?.ctxData})}a.nextBlockId&&!a.destroyWorker?f>0?setTimeout((()=>{g(a.nextBlockId,a.data)}),f):g(a.nextBlockId,a.data):this.engine.destroyWorker(this.id)}catch(a){console.error(a);const o={message:a.message,...a.data||{},...a.ctxData||{}},{onError:n}=w.data;if(n&&n.enable){if(n.retry&&n.retryTimes)return await(0,r._v)(1e3*n.retryInterval),n.retryTimes-=1,void await this.executeBlock(w,t,!0);if(n.insertData)for(const e of n.dataToInsert){let t=(await(0,m.Z)(e.value,p,this.engine.isPopup))?.value;t=(0,r.Rx)(t,t),"variable"===e.type?await this.setVariable(e.name,t):this.addDataToColumn(e.name,t)}const i=this.getBlockConnections(e.id,"continue"===n.toDo?1:"fallback");if("error"!==n.toDo&&i)return b("error",o),void g(i,u);"error"===n.toDo&&n.errorMessage.trim()&&(o.message=n.errorMessage,a.message=n.errorMessage)}const i=o;b("error",i),i.blockId=e.id;const{onError:s}=this.settings,l=this.getBlockConnections(e.id);if("keep-running"===s&&l)setTimeout((()=>{g(l,a.data||"")}),f);else if("restart-workflow"!==s||this.parentWorkflow)this.engine.destroy("error",a.message,i);else{const e=this.engine.restartWorkersCount[this.id]||0;if(e>=(this.settings.restartTimes??3))return delete this.engine.restartWorkersCount[this.id],void this.engine.destroy("error",a.message,i);this.reset();const o=this.engine.blocks[this.engine.triggerBlockId];o&&this.executeBlock(o,t),this.engine.restartWorkersCount[this.id]=e+1}}}reset(){this.loopList={},this.repeatedTasks={},this.windowId=null,this.currentBlock=null,this.childWorkflowId=null,this.engine.history=[],this.engine.preloadScripts=[],this.engine.columns={column:{index:0,type:"any",name:this.settings?.defaultColumnName||"column"}},this.activeTab={url:"",frameId:0,frames:{},groupId:null,id:this.options?.tabId},this.engine.referenceData={table:[],loopData:{},workflow:{},googleSheets:{},variables:this.engine.options?.variables||{},globalData:this.engine.referenceData.globalData}}async _sendMessageToTab(e,t={},a=!1){try{if(!this.activeTab.id){const e=new Error("no-tab");throw e.workflowId=this.id,e}a||await(0,u.Hh)({tabId:this.activeTab.id,ms:this.settings?.tabLoadTimeout??3e4});const{executedBlockOnWeb:o,debugMode:i}=this.settings,s={isBlock:!0,debugMode:i,executedBlockOnWeb:o,loopEls:this.loopEls,activeTabId:this.activeTab.id,frameSelector:this.frameSelector,...e};return await n.Z.tabs.sendMessage(this.activeTab.id,s,{frameId:this.activeTab.frameId,...t})}catch(o){console.error(o);const i=o.message?.includes("Could not establish connection"),s=o.message?.includes("message channel closed");if(i||s){if(await n.Z.contentScript.inject({file:"./contentScript.bundle.js",target:{tabId:this.activeTab.id,frameId:this.activeTab.frameId},waitUntilInjected:!0})){return await this._sendMessageToTab(e,t,a)}o.message="Could not establish connection to the active tab"}else o.message?.startsWith("No tab")&&(o.message="active-tab-removed");throw o}}};let f=(0,s.V)();class b{constructor(e,{states:t,logger:a,blocksHandler:o,isPopup:n,options:i}){this.id=(0,d.x0)(),this.states=t,this.logger=a,this.workflow=e,this.isPopup=n??!0,this.blocksHandler=o,this.isTestingMode=e.testingMode,this.parentWorkflow=i?.parentWorkflow,this.saveLog=e.settings?.saveLog??!0,this.workerId=0,this.workers=new Map,this.packagesCache={},this.extractedGroup={},this.connectionsMap={},this.waitConnections={},this.isDestroyed=!1,this.isUsingProxy=!1,this.isInBreakpoint=!1,this.triggerBlockId=null,this.blocks={},this.history=[],this.columnsId={},this.historyCtxData={},this.eventListeners={},this.preloadScripts=[],this.columns={column:{index:0,type:"any",name:this.workflow.settings?.defaultColumnName||"column"}},this.rowData={},this.logsLimit=1001,this.logHistoryId=0;let s={},{globalData:l}=e;i&&i?.data&&(l=i.data.globalData||l,s=(0,r.Kn)(i.data.variables)?i?.data.variables:{},i.data={globalData:l,variables:s}),this.options=i,this.refDataSnapshots={},this.refDataSnapshotsKeys={loopData:{index:0,key:"##loopData0"},variables:{index:0,key:"##variables0"}},this.referenceData={variables:s,table:[],secrets:{},loopData:{},workflow:{},googleSheets:{},globalData:(0,r.Rx)(l,l)},this.onDebugEvent=({tabId:e},t,a)=>{let o=!1;this.workers.forEach((t=>{o||(o=t.activeTab.id===e)})),o&&(this.eventListeners[t]||[]).forEach((e=>{e(a)}))},this.onWorkflowStopped=e=>{this.id!==e||this.isDestroyed||this.stop()},this.onResumeExecution=({id:e,nextBlock:t})=>{this.id!==e||this.isDestroyed||this.workers.forEach((e=>{e.resume(t)}))}}async init(){try{if(this.workflow.isDisabled)return;if(!this.states)return console.error(`"${this.workflow.name}" workflow doesn't have states`),void this.destroy("error");console.log("before execute",this.state,"\n",this.workflow);const{nodes:e,edges:t}=this.workflow.drawflow;if(!e||0===e.length)return void console.error(`${this.workflow.name} doesn't have blocks`);const a=e.find((e=>this.options?.blockId?e.id===this.options.blockId:"trigger"===e.label));if(!a)return void console.error(`${this.workflow.name} doesn't have a trigger block`);this.workflow.settings||(this.workflow.settings={}),f=(0,s.V)();const i=this.options?.checkParams??!0;if(i&&a.data?.parameters?.length>0){if(this.eventListeners={},a.data.preferParamsInTab){const[e]=await n.Z.tabs.query({active:!0,url:"*://*/*",lastFocusedWindow:!0});if(e){if(await n.Z.tabs.sendMessage(e.id,{type:"input-workflow-params",data:{workflow:this.workflow,params:a.data.parameters}}))return}}const e=n.Z.runtime.getURL("params.html"),t=(await n.Z.tabs.query({})).find((t=>t.url?.includes(e)));if(t)await n.Z.tabs.sendMessage(t.id,{name:"workflow:params",data:this.workflow}),await n.Z.windows.update(t.windowId,{focused:!0});else{let e="";e=this.workflow.hostId?`hosted:${this.workflow.hostId}`:this.workflow.id,n.Z.windows.create({type:"popup",width:480,height:700,url:n.Z.runtime.getURL(`/params.html?workflowId=${e}`)})}return}this.triggerBlockId=a.id,this.blocks=e.reduce(((e,t)=>(e[t.id]=t,e)),{}),this.connectionsMap=t.reduce(((e,{sourceHandle:t,target:a,targetHandle:o})=>(e[t]||(e[t]=new Map),e[t].set(a,{id:a,targetHandle:o,sourceHandle:t}),e)),{});const r=this.workflow.table||this.workflow.dataColumns||[];let l=Array.isArray(r)?r:Object.values(r);if(this.workflow.connectedTable){const e=await o.Z.tablesItems.where("id").equals(this.workflow.connectedTable).first(),t=await o.Z.tablesData.where("tableId").equals(e?.id).first();e&&t?(l=Object.values(e.columns),Object.assign(this.columns,t.columnsIndex),this.referenceData.table=t.items||[]):this.workflow.connectedTable=null}if(l.forEach((({name:e,type:t,id:a})=>{const o=a||e;this.rowData[e]=null,this.columnsId[e]=o,this.columns[o]||(this.columns[o]={index:0,name:e,type:t})})),this.workflow.settings.debugMode&&n.Z.debugger.onEvent.addListener(this.onDebugEvent),this.workflow.settings.reuseLastState&&!this.workflow.connectedTable){const e=`state:${this.workflow.id}`,t=(await n.Z.storage.local.get(e))[e];t&&(Object.assign(this.columns,t.columns),Object.assign(this.referenceData,t.referenceData))}const{settings:c={}}=await n.Z.storage.local.get("settings")||{};this.logsLimit=c?.logsLimit||1001,this.workflow.table=l,this.startedTimestamp=Date.now(),this.states.on("stop",this.onWorkflowStopped),this.states.on("resume",this.onResumeExecution);(await o.Z.credentials.toArray()).forEach((({name:e,value:t})=>{this.referenceData.secrets[e]=t}));(await o.Z.variables.toArray()).forEach((({name:e,value:t})=>{this.referenceData.variables[`$$${e}`]=t})),this.addRefDataSnapshot("variables"),await this.states.add(this.id,{id:this.id,status:"running",state:this.state,workflowId:this.workflow.id,parentState:this.parentWorkflow,teamId:this.workflow.teamId||null}),this.addWorker({blockId:a.id})}catch(e){console.error("WorkflowEngine init error:",e)}}addRefDataSnapshot(e){this.refDataSnapshotsKeys[e].index+=1,this.refDataSnapshotsKeys[e].key=e;const t=this.refDataSnapshotsKeys[e].key;this.refDataSnapshots[t]=c()(this.referenceData[e])}addWorker(e){this.workerId+=1;const t=`worker-${this.workerId}`,a=new w(t,this,{blocksDetail:f});a.init(e),this.workers.set(a.id,a)}addLogHistory(e){if("blocks-group"===e.name)return;const t=this.history?.length>=this.logsLimit,a="error"!==e.type;if(!t&&this.saveLog||!a){if(this.logHistoryId+=1,e.id=this.logHistoryId,"delay"!==e.name||e.replacedValue||"javascript-code"===e.name||f[e.name]?.refDataKeys&&this.saveLog){const{variables:t,loopData:a}=this.refDataSnapshotsKeys;this.historyCtxData[this.logHistoryId]={referenceData:{loopData:a.key,variables:t.key,activeTabUrl:e.activeTabUrl,prevBlockData:e.prevBlockData||""},replacedValue:c()(e.replacedValue),...e?.ctxData||{}},delete e.replacedValue}this.history.push(e)}}async stop(){try{this.childWorkflowId&&await this.states.stop(this.childWorkflowId),await this.destroy("stopped")}catch(e){console.error(e)}}async executeQueue(){const{workflowQueue:e}=await n.Z.storage.local.get("workflowQueue")||{workflowQueue:[]},t=(e||[]).indexOf(this.workflow?.id);if(!e||-1===t)return;new b(this.workflow,{logger:this.logger,states:this.states,blocksHandler:this.blocksHandler}).init(),e.splice(t,1),await n.Z.storage.localSet({workflowQueue:e})}async destroyWorker(e){1===this.workers.size&&this.workers.has(e)&&(this.addLogHistory({type:"finish",name:"finish"}),this.dispatchEvent("finish"),await this.destroy("success")),this.workers.delete(e),0===this.workers.size&&this.destroy("success")}async destroy(e,t,a){const s=()=>{this.id=null,this.states=null,this.logger=null,this.saveLog=null,this.workflow=null,this.blocksHandler=null,this.parentWorkflow=null,this.isDestroyed=!0,this.referenceData=null,this.eventListeners=null,this.packagesCache=null,this.extractedGroup=null,this.connectionsMap=null,this.waitConnections=null,this.blocks=null,this.history=null,this.columnsId=null,this.historyCtxData=null,this.preloadScripts=null};try{if(this.isDestroyed)return;this.isUsingProxy&&n.Z.proxy.clearSettings({}),this.workflow.settings.debugMode&&(n.Z.debugger.onEvent.removeListener(this.onDebugEvent),await(0,r._v)(1e3),this.workers.forEach((e=>{e.debugAttached&&n.Z.debugger.detach({tabId:e.activeTab.id})})));const l=Date.now();if(this.workers.clear(),this.executeQueue(),this.states.off("stop",this.onWorkflowStopped),await this.states.delete(this.id),!this.workflow.settings?.debugMode){const{user:a}=await n.Z.storage.local.get("user")||{user:null},o={workflowId:this.workflow.id,workflowName:this.workflow.name,nodesCount:this.workflow.drawflow.nodes.length,status:e,message:t||"",startedAt:new Date(this.startedTimestamp).toISOString(),endedAt:new Date(l).toISOString(),userId:a?.id};try{const e=await(0,i.a8)("/workflows/logs/report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o),auth:!0});if(!e.ok)throw new Error(`API request failed: ${e.status}`)}catch(e){console.error("Failed to report workflow execution:",e)}}if(this.dispatchEvent("destroyed",{status:e,message:t,blockDetail:a,id:this.id,endedTimestamp:l,history:this.history,startedTimestamp:this.startedTimestamp}),this.workflow.settings.reuseLastState){const e={[`state:${this.workflow.id}`]:{columns:this.columns,referenceData:{table:this.referenceData.table,variables:this.referenceData.variables}}};n.Z.storage.localSet(e)}else"success"===e&&(0,r.LK)(this.workflow);const{table:c,variables:d}=this.referenceData,u=this.workflow.connectedTable;if(Object.values(this.referenceData.workflow).forEach((e=>{Object.assign(c,e.table),Object.assign(d,e.variables)})),await o.Z.transaction("rw",o.Z.tablesItems,o.Z.tablesData,(async()=>{u&&(await o.Z.tablesItems.update(u,{modifiedAt:Date.now(),rowsCount:c.length}),await o.Z.tablesData.where("tableId").equals(u).modify({items:c,columnsIndex:this.columns}))})),!this.workflow?.isTesting){const{name:a,id:o,teamId:n}=this.workflow;await this.logger.add({detail:{name:a,status:e,teamId:n,message:t,id:this.id,workflowId:o,saveLog:this.saveLog,endedAt:l,parentLog:this.parentWorkflow,startedAt:this.startedTimestamp},history:{logId:this.id,data:this.saveLog?this.history:[]},ctxData:{logId:this.id,data:{ctxData:this.historyCtxData,dataSnapshot:this.refDataSnapshots}},data:{logId:this.id,data:{table:[...this.referenceData.table],variables:{...this.referenceData.variables}}}})}s()}catch(e){console.error("workflowEngine error",e),s()}}async updateState(e){const t={...e,tabIds:[],currentBlock:[],name:this.workflow.name,logs:this.history,ctxData:{ctxData:this.historyCtxData,dataSnapshot:this.refDataSnapshots},startedTimestamp:this.startedTimestamp};this.workers.forEach((e=>{const{id:a,label:o,startedAt:n}=e.currentBlock;t.currentBlock.push({id:a,name:o,startedAt:n}),t.tabIds.push(e.activeTab.id)})),await this.states.update(this.id,{state:t}),this.dispatchEvent("update",{state:t})}dispatchEvent(e,t){const a=this.eventListeners[e];a&&a.forEach((e=>{e(t)}))}on(e,t){(this.eventListeners[e]=this.eventListeners[e]||[]).push(t)}}const g=b},28617:(e,t,a)=>{"use strict";a.d(t,{Z:()=>n});var o=a(83869);const n=class{async add({detail:e,history:t,ctxData:a,data:n}){const i={...o.g,...e};await Promise.all([o.Z.logsData.add(n),o.Z.ctxData.add(a),o.Z.items.add(i),o.Z.histories.add(t)])}}},44647:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>w});var o=a(34983),n=a(28875),i=a(9044),s=a(14776),r=a(99137),l=a(70245),c=a(49525),d=a(34713),u=a(28617),p=a(89984);const h={get:()=>n.Z.storage.local.get("workflowStates").then((({workflowStates:e})=>e||[])),set(e,t){const a=Object.values(t);return n.Z.storage.local.set({workflowStates:a})}};class m{static#e;static get instance(){return this.#e||(this.#e=new m),this.#e}#t;#a;constructor(){this.#a=new u.Z,this.#t=new p.Z({storage:h})}execute(e,t){if(e.testingMode)for(const t of this.#t.states.values())if(t.workflowId===e.id)return null;const a=(0,s.Z)(e),u=new c.Z(a,{options:t,states:this.#t,logger:this.#a,blocksHandler:(0,l.Z)()});return u.init(),u.on("destroyed",(({id:t,status:o,history:i,blockDetail:s,...l})=>{if("stopped"!==o&&n.Z.permissions.contains({permissions:["notifications"]}).then((a=>{if(!a||!e.settings.notification)return;const i=e.name.slice(0,32);n.Z.notifications.create(`logs:${t}`,{type:"basic",iconUrl:n.Z.runtime.getURL("icon-128.png"),title:"success"===o?"Success":"Error",message:`${"success"===o?"Successfully":"Failed"} ran the "${i}" workflow`})})),a.settings?.events){const e=i.map((e=>(delete e.logId,delete e.prevBlockData,delete e.workerId,e.description=e.description||"",e))),t={status:o,startedAt:l.startedTimestamp,endedAt:l.endedTimestamp?l.endedTimestamp-l.startedTimestamp:null,logs:e,errorMessage:"error"===o?(0,r.Z)(s):null};a.settings.events.forEach((e=>{("success"!==o||e.events.includes("finish:success"))&&("error"!==o||e.events.includes("finish:failed"))&&d.Z.handle(e.action,{workflow:t,variables:{...u.referenceData.variables},globalData:{...u.referenceData.globalData}})}))}})),n.Z.storage.local.get("checkStatus").then((e=>{const{checkStatus:t}=e||{checkStatus:null};!!t&&(0,o.Z)().isSame(t,"day")&&t||(0,i.a8)("/status").then((e=>e.json())).then((()=>{n.Z.storage.local.set({checkStatus:(new Date).toString()})})).catch((e=>{console.error("Failed to check status:",e)}))})).catch((e=>{console.error("Failed to get checkStatus:",e)})),u}stopExecution(e){return this.#t.stop(e)}resumeExecution(e,t){return this.#t.resume(e,t)}updateExecution(e,t){return this.#t.update(e,t)}}const w=m},89984:(e,t,a)=>{"use strict";a.d(t,{Z:()=>n});var o=a(28875);const n=class{constructor({storage:e,key:t="workflowState"}){this.key=t,this.storage=e,this.states=new Map,this.eventListeners={},this.storageTimeout=null}_updateBadge(){o.Z.browserAction.setBadgeText({text:(this.states.size||"").toString()})}_saveToStorage(){this.storageTimeout||(this.storageTimeout=setTimeout((()=>{this.storageTimeout=null;const e=Object.fromEntries(this.states);this.storage.set(this.key,e)}),1e3))}dispatchEvent(e,t){const a=this.eventListeners[e];a&&a.forEach((e=>{e(t)}))}on(e,t){(this.eventListeners[e]=this.eventListeners[e]||[]).push(t)}off(e,t){const a=this.eventListeners[e];if(!a)return;const o=a.indexOf(t);-1!==o&&a.splice(o,1)}get getAll(){return this.states}async get(e){let{states:t}=this;return"function"==typeof e?t=Array.from(t.entries()).find((({1:t})=>e(t))):e&&(t=this.states.get(e)),t}async add(e,t={}){this.states.set(e,t),this._updateBadge(),this._saveToStorage(this.key)}async stop(e){return await this.get(e)?(await this.update(e,{isDestroyed:!0}),this.dispatchEvent("stop",e),e):(await this.delete(e),this.dispatchEvent("stop",e),e)}async resume(e,t){const a=this.states.get(e);a&&(this.states.set(e,{...a,status:"running"}),this._saveToStorage(),this.dispatchEvent("resume",{id:e,nextBlock:t}))}async update(e,t={}){const a=this.states.get(e);a&&(t?.state?.status&&(a.status=t.state.status,delete t.state.status),this.states.set(e,{...a,...t}),this.dispatchEvent("update",{id:e,data:t}),this._saveToStorage())}async delete(e){this.states.delete(e),this.dispatchEvent("delete",e),this._updateBadge(),this._saveToStorage()}}},70245:(e,t,a)=>{"use strict";a.d(t,{Z:()=>r});var o=a(87360),n=a(32350);const i=a(4606),s=i.keys().reduce(((e,t)=>{const a=t.replace(/^\.\/handler|\.js/g,"");return e[(0,o.zW)(a)]=i(t).default,e}),{});function r(){return{...s,...(0,n.Z)()}}},2673:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});var o=a(87360),n=a(28875),i=a(72112);const s=async function(e){try{const t={data:"",nextBlockId:this.getBlockConnections(e.id)};if(this.activeTab.id)return await n.Z.tabs.update(this.activeTab.id,{active:!0}),t;const a={active:!0,url:"*://*/*"};if(this.engine.isPopup){let e=null;const t=n.Z.runtime.getURL(""),o=await n.Z.windows.getAll({populate:!0});for(const a of o){const[o]=a.tabs;1===a.tabs.length&&o.url?.includes(t)?await n.Z.windows.update(a.id,{focused:!1}):a.focused&&(e=a.id)}e?a.windowId=e:o.length>2&&(a.lastFocusedWindow=!0)}else{const e=await n.Z.tabs.query({url:n.Z.runtime.getURL("/newtab.html")});await Promise.all(e.map((e=>n.Z.windows.update(e.windowId,{focused:!1})))),a.currentWindow=!0}const[s]=await n.Z.tabs.query(a);if(!s)throw new Error("Can't find active tab");if(!s||!s?.url.startsWith("http")){const e=new Error("invalid-active-tab");throw e.data={url:s?.url},e}return this.activeTab={...this.activeTab,frameId:0,id:s.id,url:s.url},this.windowId=s.windowId,this.settings.debugMode&&(await(0,i.xq)(s.id,this.activeTab.id),this.debugAttached=!0),this.preloadScripts.length>0&&(this.engine.isMV2?await this._sendMessageToTab({isPreloadScripts:!0,label:"javascript-code",data:{scripts:this.preloadScripts}}):await(0,i.SR)({scripts:this.preloadScripts,frameSelector:this.frameSelector,target:{tabId:this.activeTab.id,frameIds:[this.activeTab.frameId||0]}})),await n.Z.tabs.update(s.id,{active:!0}),await n.Z.windows.update(s.windowId,{focused:!0}),await(0,o._v)(200),t}catch(e){throw console.error(e),e.data=e.data||{},e}}},22116:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});var o=a(30503);const n=a.n(o)().apApiUrl;var i=a(87491);const s=async function(e,{refData:t}){const{flowUuid:a,inputs:o,assignVariable:s,variableName:r,saveData:l,dataColumn:c}=e.data,d={},u=this.engine.workflow.settings?.aipowerToken;if(!u)throw new Error("AI Power token is not set");const p={};for(const e of o)if("object"==typeof e.value&&null!==e.value)p[e.name]=e.value;else{const a=await(0,i.Z)(e.value,t,this.engine.isPopup);p[e.name]=a.value,Object.assign(d,a.list)}try{const t=await(async({flowUuid:e,input:t},a)=>{const o=`${n}/oapi/power/v1/rest/flow/${e}/execute`,i=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:`Bearer ${a}`},body:JSON.stringify({input:t,source:"automa_extension"})});if(!i.ok){const e=await i.text();throw console.error("Failed to execute AI Power workflow:",{status:i.status,data:e}),new Error(`HTTP error! status: ${i.status}`)}return i.json()})({flowUuid:a,input:p},u),{success:o,msg:i}=t;if(!o)throw new Error(i||"AI workflow execution failed");s&&this.setVariable(r,t.data.result),l&&this.addDataToColumn(c,t.data.result);const h=this.getBlockConnections(e.id);return{data:t.data.result,nextBlockId:h,replacedValue:d}}catch(e){throw console.error("AI workflow execution failed:",e),new Error(e.message)}}},49279:(e,t,a)=>{"use strict";async function o({data:e,id:t},{targetHandle:a,prevBlockData:o}){this.engine.packagesCache[t]||(this.engine.packagesCache[t]={extracted:!1,nodes:{}});const n=this.engine.packagesCache[t],{1:i}=a.split("input-"),s=e=>`${t}__${e}`,r=n.nodes[i];if(r)return{data:o,nextBlockId:[{id:r}]};const l=e.inputs.find((e=>e.id===i));if(!l)throw new Error("Input not found");const c=e.data.nodes.find((e=>e.id===l.blockId));n.nodes[i]=s(c.id);const d={};if(!n.extracted){const a=new Set;if(e.inputs.forEach((e=>{d[s(e.id)]=new Map([[e.id,{id:s(e.blockId),targetId:`${s(c.id)}-input-1`}]])})),e.outputs.forEach((e=>{const o=this.engine.connectionsMap[`${t}-output-${e.id}`];o&&(d[s(e.handleId)]=new Map(o),a.add(e.handleId))})),e.data.nodes.forEach((e=>{const t=s(e.id);this.engine.blocks[t]={...e,id:t}})),!c)throw new Error("Can't find block for this input");e.data.edges.forEach((({sourceHandle:e,target:t,targetHandle:o})=>{if(a.has(e))return;const n=s(e);d[n]||(d[n]=new Map);const i=s(t);d[n].set(i,{id:i,sourceHandle:n,targetHandle:s(o)})})),n.extracted=!0}return Object.assign(this.engine.connectionsMap,d),{data:o,nextBlockId:[{id:s(c.id)}]}}a.r(t),a.d(t,{default:()=>o})},44220:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});const o=function({data:e,id:t},{prevBlockData:a}){return new Promise((o=>{const n=this.getBlockConnections(t);if(0===e.blocks.length)return void o({nextBlockId:n,data:a});const{blocks:i,connections:s}=e.blocks.reduce(((a,o,n)=>{const i=e.blocks[n+1]?.itemId;if(a.blocks[o.itemId]={label:o.id,data:o.data,id:i?o.itemId:t},i){const e=`${o.itemId}-output-1`;a.connections[e]||(a.connections[e]=new Map),a.connections[e].set(i,{id:i})}return a}),{blocks:{},connections:{}});Object.assign(this.engine.blocks,i),Object.assign(this.engine.connectionsMap,s),o({data:a,nextBlockId:[{id:e.blocks[0].itemId}]})}))}},35362:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var o=a(87360),n=a(28875);function i(e,t){return(a,o)=>new Promise((n=>{let i=!1;const s=r=>{i||t&&!t(r,{data:a,activeTab:o})||(e.removeListener(s),n(r))};setTimeout((()=>{i=!0,e.removeListener(s),n("")}),a.timeout||1e4),e.addListener(s)}))}const s=({url:e},{data:t})=>{if(!(0,o.cb)(t.tabUrl)){if(!new RegExp(t.tabUrl,"gi").test(e))return!1}return!0},r={"tab:loaded":function({tabLoadedUrl:e,activeTabLoaded:t,timeout:a},{id:i}){return new Promise(((s,r)=>{let l=!1;const c=()=>{l||(i?n.Z.tabs.get(i).then((e=>{"complete"!==e.status?setTimeout(c,1e3):s()})).catch(r):r(new Error("no-tab")))},d=(0,o.cb)(e)?"<all_urls>":e.replace(/\s/g,"").split(","),u=()=>{n.Z.tabs.query({url:d,status:"loading"}).then((e=>{l||(0!==e.length?setTimeout(u,1e3):s())})).catch(r)};t?c():u(),setTimeout((()=>{l=!0,r(new Error("timeout"))}),a||1e4)}))},"tab:close":i(n.Z.tabs.onRemoved),"tab:create":i(n.Z.webNavigation.onCreatedNavigationTarget,s),"window:create":i(n.Z.webNavigation.onCreatedNavigationTarget,s),"window:close":i(n.Z.windows.onRemoved)};async function l({data:e,id:t}){const a=r[e.eventName];if(!a)throw new Error(`Can't find ${e.eventName} event`);const o=await a(e,this.activeTab);return"tab:create"===e.eventName&&e.setAsActiveTab&&(this.activeTab.id=o.tabId,this.activeTab.url=o.url),{data:o||"",nextBlockId:this.getBlockConnections(t)}}},83990:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});var o=a(2518),n=a(28875),i=a(72112);function s(e,t){const a=document.createElement("textarea");return document.body.appendChild(a),"paste"===e?(a.focus(),document.execCommand("paste"),t=a.value):"copy"===e&&(a.value=t,a.select(),document.execCommand("copy"),a.blur()),a.remove(),t}async function r({data:e,id:t,label:a}){if(!o.D&&!this.engine?.isPopup&&!this.engine?.isMV2)throw new Error("Clipboard block is not supported in background execution");const r=["clipboardRead"];o.D&&r.push("clipboardWrite");if(!await n.Z.permissions.contains({permissions:r}))throw new Error("no-clipboard-acces");let l="";if(e.type&&"get"!==e.type){if("insert"===e.type){let n="";if(e.copySelectedText){if(!this.activeTab.id)throw new Error("no-tab");n=await this._sendMessageToTab({id:t,label:a})}else n=e.dataToCopy;l=n,o.D?await(0,i.TE)(n):s("copy",n)}}else{const t=s("paste");l=t,e.assignVariable&&await this.setVariable(e.variableName,t),e.saveData&&this.addDataToColumn(e.dataColumn,t)}return{data:l,nextBlockId:this.getBlockConnections(t)}}},53022:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});var o=a(28875);async function n({data:e,id:t}){return"window"===e.closeType?(await async function(e,t){const a=[];if(e.allWindows)(await o.Z.windows.getAll()).forEach((({id:e})=>{a.push(e)}));else{let e;e=t&&"number"==typeof t?t:(await o.Z.windows.getCurrent()).id,a.push(e)}await Promise.allSettled(a.map((e=>o.Z.windows.remove(e))))}(e,this.windowId),this.windowId=null):(await async function(e,t){let a;e.activeTab&&t?a=t:e.url&&(a=(await o.Z.tabs.query({url:e.url})).map((e=>e.id))),a&&await o.Z.tabs.remove(a)}(e,this.activeTab.id),e.activeTab&&(this.activeTab.id=null)),{data:"",nextBlockId:this.getBlockConnections(t)}}},92482:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});const o={"==":(e,t)=>e===t,"!=":(e,t)=>e!==t,">":(e,t)=>e>t,">=":(e,t)=>e>=t,"<":(e,t)=>e<t,"<=":(e,t)=>e<=t,"()":(e,t)=>e?.includes(t)??!1};function n(e,t,a){const n=o[e];return!!n&&n(t,a)}var i=a(13282),s=a(87491),r=a(76678);const l=async function({data:e,id:t},{prevBlockData:a,refData:o}){if(0===e.conditions.length)throw new Error("conditions-empty");let l="",c=!1,d="fallback";const u={},p=e.conditions[0],h=Array.isArray(a)?a[0]:a,{debugMode:m}=this.engine.workflow?.settings||{};if(p&&p.conditions){const a={isMV2:false,refData:o,isPopup:this.engine.isPopup,checkCodeCondition:e=>(e.debugMode=m,(0,r.Z)(this.activeTab,e)),sendMessage:e=>this._sendMessageToTab({...e.data,label:"conditions",id:t})},n=await function(e,t){return new Promise(((a,o)=>{let n=1;const s={},r=async()=>{try{for(let o=0;o<e.conditions.length;o+=1){const n=await(0,i.Z)(e.conditions[o].conditions,t);if(Object.assign(s,n?.replacedValue||{}),n.isMatch)return void a({match:!0,index:o,replacedValue:s})}e.retryConditions&&n<=e.retryCount?(n+=1,setTimeout((()=>{r()}),e.retryTimeout)):a({match:!1,replacedValue:s})}catch(e){o(e)}};r()}))}(e,a);n.replacedValue&&Object.assign(u,n.replacedValue),n.match&&(c=!0,d=e.conditions[n.index].id)}else for(const{type:t,value:a,compareValue:i,id:r}of e.conditions){if(c)break;const e=(await(0,s.Z)(i??h,o,this.engine.isPopup)).value,p=(await(0,s.Z)(a,o,this.engine.isPopup)).value;Object.assign(u,e.list,p.list);n(t,e.value,p.value)&&(d=r,l=a,c=!0)}return{replacedValue:u,data:l,nextBlockId:this.getBlockConnections(t,d)}}},16997:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});var o=a(28875),n=a(87360);const i={get:["name","url"],remove:["name","url"],getAll:["domain","name","path","secure","url"],set:["name","url","expirationDate","domain","path","sameSite","secure","url","value","httpOnly"]};const s=async function({data:e,id:t}){if(!await o.Z.permissions.contains({permissions:["cookies"]})){const e=new Error("no-permission");throw e.data={permission:"cookies"},e}let a=e.type;"get"===a&&e.getAll&&(a="getAll");let s=null;if(e.useJson){const t=(0,n.Rx)(e.jsonCode,null);if(!t)throw new Error("Invalid JSON format");s=await o.Z.cookies[a](t)}else{const t=function(e,t){const a={};return t.forEach((t=>{const o=e[t];o&&(a[t]=o)})),a}(e,i[a]);if(t.expirationDate&&(t.expirationDate=Date.now()/1e3+ +t.expirationDate),"remove"!==e.type||e.name)s=await o.Z.cookies[a](t);else{const t=await o.Z.cookies.getAll({url:e.url}),a=t.map((({name:t})=>o.Z.cookies.remove({name:t,url:e.url})));await Promise.allSettled(a),s=t}}return"get"===e.type&&(e.assignVariable&&await this.setVariable(e.variableName,s),e.saveData&&this.addDataToColumn(e.dataColumn,s)),{data:s,nextBlockId:this.getBlockConnections(t)}}},290:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var o=a(50543),n=a(96973),i=a(72112);const s=(0,n.k)("1234567890abcdef",5);function r(e){const t=`automa${s()}`;return`\nconst ${t} = ${JSON.stringify(e)};\n${(0,i.XB)(t)}\nfunction automaSetVariable(name, value) {\n  const variables = ${t}.variables;\n  if (!variables) ${t}.variables = {}\n\n  ${t}.variables[name] = value;\n}\nfunction automaExecWorkflow(options = {}) {\n  window.dispatchEvent(new CustomEvent('automa:execute-workflow', { detail: options }));\n}\n  `}const l=async function(e,{refData:t}){if(!this.activeTab.id)throw new Error("no-tab");const{data:a}=e,n=(await Promise.allSettled(a.preloadScripts.map((e=>e.src.startsWith("http")?fetch(e.src).then((e=>e.text())).then((t=>({type:e.type,script:t}))):Promise.reject(new Error("Invalid URL")))))).reduce(((e,t)=>("rejected"===t.status||e.push(t.value),e)),[]);a.preloadScripts=n;const s=!this.engine.isMV2,l={...e,data:{...a,automaScript:r({...t,secrets:{}})},preloadCSS:a.preloadScripts.filter((e=>"style"===e.type))};if(s&&(l.data.dontInjectJS=!0),await this._sendMessageToTab(l,{},a.runBeforeLoad??!1),s){const t={tabId:this.activeTab.id,frameIds:[this.activeTab.frameId||0]},{debugMode:s=!1}=this.engine.workflow?.settings||{},r=`\n      function() {\n        // \n        const preloadScripts = ${JSON.stringify(n)};\n        const blockId = "${e.id}";\n        const automaScript = ${JSON.stringify(l.data?.automaScript||"")};\n        const javascript = ${JSON.stringify(a.javascript||"")};\n\n        // JavaScript\n        return \`\n          // \n          \${preloadScripts.map(item => {\n            if (item.type === 'style') return '';\n            return \`try { eval(\${JSON.stringify(item.script)}); } catch(e) { console.error(':', e); }\`;\n          }).join('\\n')}\n\n          // JavaScript\n          try {\n            (function() {\n              \${automaScript}\n              \${javascript}\n            })();\n          } catch(error) {\n            console.error('JavaScript:', error);\n          }\n\n          // undefined\n          true;\n        \`;\n      }\n    `;if((await(0,i.uh)({target:t,debugMode:s,options:{awaitPromise:!1,returnByValue:!0}},r)).isBlocked)console.log("CreateElement: CSP");else{const i=(c=a.javascript,d=e.id,u=l.data?.automaScript||"",p=n||[],`\n    const baseId = 'automa-${d}';\n\n    ${JSON.stringify(p)}.forEach((item) => {\n      if (item.type === 'style') return;\n\n      const script = document.createElement(item.type);\n      script.id = \`\${baseId}-script\`;\n      script.textContent = item.script;\n\n      document.body.appendChild(script);\n    });\n\n    const script = document.createElement('script');\n    script.id = \`\${baseId}-javascript\`;\n    script.textContent = \`(() => { ${u}\n${c} })()\`;\n\n    document.body.appendChild(script);\n  `);await o.m.sendMessage("script:execute-callback",{target:t,callback:i},"background")}}var c,d,u,p;return{data:"",nextBlockId:this.getBlockConnections(e.id)}}},16476:(e,t,a)=>{"use strict";a.r(t),a.d(t,{dataMapping:()=>r,default:()=>l});var o=a(81843),n=a.n(o),i=a(87360);function s(e,t){const a={};return t.forEach((t=>{if(!n().has(e,t.name))return;const o=n().get(e,t.name);t.destinations.forEach((({name:e})=>{n().set(a,e,o)}))})),a}async function r({id:e,data:t}){let a=null;if("table"===t.dataSource)a=this.engine.referenceData.table;else if("variable"===t.dataSource){const{variables:e}=this.engine.referenceData;if(!(0,i.aX)(e,t.varSourceName))throw new Error(`Cant find "${t.varSourceName}" variable`);a=e[t.varSourceName]}if(!(0,i.Kn)(a)&&!Array.isArray(a)){throw new Error(`Can't map data with "${null===a?"null":typeof a}" data type`)}return a=(0,i.Kn)(a)?s(a,t.sources):a.map((e=>s(e,t.sources))),t.assignVariable&&await this.setVariable(t.variableName,a),t.saveData&&this.addDataToColumn(t.dataColumn,a),{data:a,nextBlockId:this.getBlockConnections(e)}}const l=r},43883:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});const o=function(e){return new Promise((t=>{const a=+e.data.time||500;setTimeout((()=>{t({data:"",nextBlockId:this.getBlockConnections(e.id)})}),a)}))}},12801:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});const o=function({data:e,id:t}){return new Promise((a=>{let o=!1;e.deleteList.forEach((e=>{if("table"===e.type)if("[all]"===e.columnId)this.engine.referenceData.table=[],Object.keys(this.engine.columns).forEach((e=>{this.engine.columns[e].index=0}));else{const t=this.engine.columns[e.columnId].name;this.engine.referenceData.table.forEach(((e,a)=>{const o=this.engine.referenceData.table[a];delete o[t],o&&0!==Object.keys(o).length||(this.engine.referenceData.table[a]={})})),this.engine.columns[e.columnId].index=0}else e.variableName&&(delete this.engine.referenceData.variables[e.variableName],o=!0)})),o&&this.engine.addRefDataSnapshot("variables"),a({data:"",nextBlockId:this.getBlockConnections(t)})}))}},23206:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});const o=function(e){return new Promise(((t,a)=>{this._sendMessageToTab(e).then((o=>{if(!o&&e.data.throwError){const t=new Error("element-not-found");return t.data={selector:e.data.selector},void a(t)}t({data:o,nextBlockId:this.getBlockConnections(e.id,o?1:2)})})).catch((e=>{a(e)}))}))}},4399:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>b});var o=a(87360),n=a(67197),i=a(71947),s=a.n(i),r=a(72726),l=a.n(r),c=a(26551),d=a.n(c),u=a(67812);var p=a(14776),h=a(28875),m=a(49525);function w(e,t){return new Promise(((a,i)=>{if(e.isProtected){if(!(0,o.Rx)(e.drawflow,null)){const t=function(e){const t=(0,u.Z)((0,n.x0)());return l().decrypt(e.substring(64),t).toString(d())}(e.pass);e.drawflow=function({pass:e,drawflow:t},a){if(e.substring(0,64)!==s()(e.substring(64),a).toString())return{isError:!0,message:"incorrect-password"};return(0,o.Rx)(t,null)||l().decrypt(t,a).toString(d())}(e,t)}}const r=new m.Z(e,t);r.init(),r.on("destroyed",(({id:e,status:o,message:n})=>{if(t.events.onDestroyed(r),"error"===o){const t=new Error(n);return t.data={logId:e},void i(t)}a({id:e,status:o,message:n})})),t.events.onInit(r)}))}function f(e,t){return Array.isArray(e)?e.find((({id:e})=>e===t)):e[t]}const b=async function({id:e,data:t},{refData:a}){if(""===t.workflowId)throw new Error("empty-workflow");const{workflows:i,teamWorkflows:s}=await h.Z.storage.local.get(["workflows","teamWorkflows"]);let r=null;if(t.workflowId.startsWith("team")){r=f(Object.values(Object.values(s||{})[0]??{}),t.workflowId)}else r=f(i,t.workflowId);if(!r){const e=new Error("no-workflow");throw e.data={workflowId:t.workflowId},e}r=(0,p.Z)(r);const l={variables:{}};if(r.testingMode&&(r.testingMode=!1),t.insertAllGlobalData&&(l.globalData=a.globalData),(0,o.cb)(t.globalData)||(l.globalData={...l.globalData,...JSON.parse(t.globalData)}),t.insertAllVars)l.variables=JSON.parse(JSON.stringify(this.engine.referenceData.variables));else if(t.insertVars){t.insertVars.split(",").forEach((e=>{const t=e.trim(),a=this.engine.referenceData.variables[t];(a||"boolean"==typeof a)&&(l.variables[t]=a)}))}const c={options:{data:l,parentWorkflow:{id:this.engine.id,name:this.engine.workflow.name}},events:{onInit:e=>{this.childWorkflowId=e.id},onDestroyed:e=>{const{variables:a,table:o}=e.referenceData;this.engine.referenceData.workflow[t.executeId||`${e.id}-${(0,n.x0)(8)}`]={table:o,variables:a}}},states:this.engine.states,logger:this.engine.logger,blocksHandler:this.engine.blocksHandler};if(r.drawflow.nodes.some((e=>"execute-workflow"===e.label&&e.data.workflowId===this.engine.workflow.id)))throw new Error("workflow-infinite-loop");return{data:"",logId:(await w(r,c)).id,nextBlockId:this.getBlockConnections(e)}}},5807:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var o=a(3534),n=a.n(o),i=a(87360);const s={"plain-text":{mime:"text/plain",ext:".txt"},json:{mime:"application/json",ext:".json"},csv:{mime:"text/csv",ext:".csv"}};function r(e,{name:t,type:a,addBOMHeader:o,csvOptions:r,returnUrl:l,returnBlob:c},d){let u=e;if("csv"===a||"json"===a){const t=d?e:function(e,t){if(Array.isArray(t))return t;const a=[];return e.forEach((e=>{for(let o=0;o<t[e].length;o+=1){const n=t[e][o];void 0===a[o]?a.push({[e]:n}):a[o][e]=n}})),a}(Object.keys(e),e);u="csv"===a?n().unparse(t,r||{}):JSON.stringify(t,null,2)}else if("plain-text"===a){const t=e=>{if("object"!=typeof e)return[e];return Object.keys(e).forEach((t=>{const a=e[t];"object"==typeof a&&(e[t]=JSON.stringify(a))})),Object.values(e)};u=(Array.isArray(e)?e.flatMap((e=>t(e))):t(e)).join(" ")}const p=[u];"csv"===a&&o&&p.unshift(new Uint8Array([239,187,191]));const{mime:h,ext:m}=s[a],w=new Blob(p,{type:h});if(c)return w;const f=URL.createObjectURL(w);return l||(0,i.AG)(`${t||"unnamed"}${m}`,f),f}var l=a(28875);const c=async function({data:e,id:t},{refData:a}){const o=e.dataToExport||"data-columns";let n=a.table;"google-sheets"===o?n=a.googleSheets[e.refKey]||[]:"variable"===o&&(n=a.variables[e.variableName]||[],Array.isArray(n)||(n=[n],"csv"===e.type&&"object"!=typeof n[0]&&(n=[n])));const i="undefined"!=typeof document;let c=r(n,{...e,csvOptions:{delimiter:e.csvDelimiter||","},returnUrl:!i});if(!i&&await l.Z.permissions.contains({permissions:["downloads"]})){c=await(d=c,new Promise((e=>{const t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(d)})));const t={filename:`${e.name||"unnamed"}${s[e.type].ext}`,conflictAction:e.onConflict||"uniquify"};await l.Z.downloads.download({...t,url:c})}var d;return{data:"",nextBlockId:this.getBlockConnections(t)}}},27882:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i,goBack:()=>n});var o=a(28875);async function n({id:e}){if(!this.activeTab.id)throw new Error("no-tab");return await o.Z.tabs.goForward(this.activeTab.id),{data:"",nextBlockId:this.getBlockConnections(e)}}const i=n},88857:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i,goBack:()=>n});var o=a(28875);async function n({id:e}){if(!this.activeTab.id)throw new Error("no-tab");return await o.Z.tabs.goBack(this.activeTab.id),{data:"",nextBlockId:this.getBlockConnections(e)}}const i=n},69067:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l,googleDrive:()=>r});var o=a(9044),n=a(5072),i=a(28875),s=a(87491);async function r({id:e,data:t},{refData:a}){const{sessionToken:r}=await i.Z.storage.local.get("sessionToken");if(!r)throw new Error("You haven't connect Google Drive");await(0,o.$1)();const l=t.filePaths.map((async e=>{let t=(await(0,s.Z)(e.path,a,this.engine.isPopup)).value;if("downloadId"===e.type){const[a]=await i.Z.downloads.search({id:+t,exists:!0,state:"complete"});if(!a||!a.filename)throw new Error(`Can't find download item with "${e.path}" id`);t=a.filename}const r=(await(0,s.Z)(e.name||"",a,this.engine.isPopup)).value||function(e){try{const t=new URL(e).pathname.split("/").pop();return/\.[0-9a-z]+$/i.test(t)?t:null}catch(e){return null}}(t),l=await(0,n.Z)(t,{returnValue:!0}),{response:c}=await(0,o.wr)("https://www.googleapis.com/upload/drive/v3/files?uploadType=resumable",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r,mimeType:l.type})},{response:!0}),d=c.headers.get("location"),u=await new Promise((e=>{const t=new FileReader;t.onload=()=>{e(t.result)},t.readAsArrayBuffer(l)}));return await(0,o.wr)(d,{method:"PUT",headers:{"Content-Length":l.size},body:u})}));return{data:await Promise.all(l),nextBlockId:this.getBlockConnections(e)}}const l=r},10849:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var o=a(9044);function n(e){let t="";return Object.entries(e).forEach((([e,a],o)=>{0!==o&&(t+="&"),t+=`${e}=${a}`})),t}const i={getUrl:e=>`https://sheets.googleapis.com/v4/spreadsheets${e}`,getValues({spreadsheetId:e,range:t}){const a=i.getUrl(`/${e}/values/${t}`);return(0,o.wr)(a)},getRange({spreadsheetId:e,range:t}){const a=i.getUrl(`/${e}/values/${t}:append?valueInputOption=RAW&includeValuesInResponse=false&insertDataOption=INSERT_ROWS`);return(0,o.wr)(a,{method:"POST"})},clearValues({spreadsheetId:e,range:t}){const a=i.getUrl(`/${e}/values/${t}:clear`);return(0,o.wr)(a,{method:"POST"})},updateValues({spreadsheetId:e,range:t,options:a,append:s}){let r="",l="";s?(r=i.getUrl(`/${e}/values/${t}:append`),l="POST"):(r=i.getUrl(`/${e}/values/${t}`),l="PUT");const c={method:l};return a.body&&(c.body=a.body),(0,o.wr)(`${r}?${n(a?.queries||{})}`,c)},create(e){const t=i.getUrl("");return(0,o.wr)(t,{method:"POST",body:JSON.stringify({properties:{title:e}})})},addSheet({sheetName:e,spreadsheetId:t}){const a=i.getUrl(`/${t}:batchUpdate`);return(0,o.wr)(a,{method:"POST",body:JSON.stringify({requests:[{addSheet:{properties:{title:e}}}]})})}},s={getUrl:(e,t)=>`/services/google-sheets?spreadsheetId=${e}&range=${t}`,getValues({spreadsheetId:e,range:t}){const a=this.getUrl(e,t);return(0,o.a8)(a)},getRange:({spreadsheetId:e,range:t})=>s.updateValues({range:t,append:!0,spreadsheetId:e,options:{body:JSON.stringify({values:[]}),queries:{valueInputOption:"RAW",includeValuesInResponse:!1,insertDataOption:"INSERT_ROWS"}}}),clearValues({spreadsheetId:e,range:t}){return(0,o.a8)(this.getUrl(e,t),{method:"DELETE"})},updateValues({spreadsheetId:e,range:t,options:a={},append:i}){const s=`${this.getUrl(e,t)}&${n(a?.queries||{})}`;return(0,o.a8)(s,{...a,method:i?"POST":"PUT"})}};function r(e=!1){return e?i:s}var l=a(87360);async function c({data:e,id:t},{refData:a}){const o=!["create","add-sheet"].includes(e.type);if((0,l.cb)(e.spreadsheetId)&&o)throw new Error("empty-spreadsheet-id");if((0,l.cb)(e.range)&&o)throw new Error("empty-spreadsheet-range");let n=[];const i=async(t=!1)=>{n=await async function({range:e,append:t,dataFrom:a,customData:o,isDriveSheet:n,spreadsheetId:i,keysAsFirstRow:s,insertDataOption:c,valueInputOption:d},u){let p=[];if(["data-columns","table"].includes(a)?p=s?(0,l.ex)(u):u.map((e=>Object.values(e))):"custom"===a&&(p=(0,l.Rx)(o,o)),Array.isArray(p)){const e=["boolean","string","number"];p.forEach(((t,a)=>{t.forEach(((t,o)=>{t&&e.includes(typeof t)||(p[a][o]=" ")}))}))}const h={valueInputOption:d||"RAW"};t&&Object.assign(h,{includeValuesInResponse:!1,insertDataOption:c||"INSERT_ROWS"});const m=await r(n).updateValues({range:e,append:t,spreadsheetId:i,options:{queries:h,body:JSON.stringify({values:p})}}),w=n?m:await m.json();if(!n&&!m.ok)throw new Error(w.message)}({...e,append:t},a.table)},s={get:async()=>{const t=await async function({spreadsheetId:e,range:t,firstRowAsKey:a,isDriveSheet:o}){const n=await r(o).getValues({spreadsheetId:e,range:t}),i=o?n:await n.json();if(!o&&!n.ok)throw new Error(i.message);return a?(0,l.Ac)(i.values):i.values}(e);n=t,e.refKey&&!(0,l.cb)(e.refKey)&&(a.googleSheets[e.refKey]=t)},getRange:async()=>{n=await async function({spreadsheetId:e,range:t,isDriveSheet:a}){const o=await r(a).getRange({spreadsheetId:e,range:t}),n=a?o:await o.json();if(!a&&!o.ok)throw new Error(n.message);return{tableRange:n.tableRange||null,lastRange:n.updates.updatedRange}}(e),e.assignVariable&&await this.setVariable(e.variableName,n),e.saveData&&this.addDataToColumn(e.dataColumn,n)},update:()=>i(),append:()=>i(!0),clear:async()=>{n=await async function({spreadsheetId:e,range:t,isDriveSheet:a}){const o=await r(a).clearValues({spreadsheetId:e,range:t}),n=a?o:await o.json();if(!a&&!o.ok)throw new Error(n.message);return n}(e)},create:async()=>{const{spreadsheetId:t}=await r(!0).create(e.sheetName);n=t,e.assignVariable&&await this.setVariable(e.variableName,n),e.saveData&&this.addDataToColumn(e.dataColumn,n)},"add-sheet":async()=>{n=await r(!0).addSheet(e),n=n.replies[0].addSheet.properties}};return await s[e.type](),{data:n,nextBlockId:this.getBlockConnections(t)}}},86718:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});var o=a(10849);function n(e,t){return e.data.isDriveSheet=!0,o.default.call(this,e,t)}},2729:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var o=a(50543),n=a(72112);const i=async function({data:e,id:t}){if(this.settings.debugMode){this.dialogParams={accept:e.accept,promptText:e.promptText};const t="Page.javascriptDialogOpening";this.engine.eventListeners[t]||this.engine.on(t,(()=>{(0,n.k)(this.activeTab.id,"Page.handleJavaScriptDialog",this.dialogParams)}))}else{if(!this.preloadScripts.some((({id:e})=>e===t))){const s=(a=e.accept,i=e.promptText,`\n  const realConfirm = window.confirm;\n  window.confirm = function() {\n    return ${a};\n  };\n\n  const realAlert = window.alert;\n  window.alert = function() {\n    return ${a};\n  };\n\n  const realPrompt = window.prompt;\n  window.prompt = function() {\n    return ${a} ? "${i}" : null;\n  }\n`),r={id:t,isBlock:!0,name:"javascript-code",isPreloadScripts:!0,data:{everyNewTab:!0,scripts:[{data:{code:s},id:t}]}};if(this.engine.isMV2)this.preloadScripts.push(r),await this._sendMessageToTab(r,{},!0);else{const e={tabId:this.activeTab.id,allFrames:!0},{debugMode:t}=this.engine.workflow.settings;(await(0,n.uh)({target:e,debugMode:t,injectOptions:{injectImmediately:!0}})).isBlocked||o.m.sendMessage("script:execute-callback",{target:e,callback:s},"background")}}}var a,i;return{data:"",nextBlockId:this.getBlockConnections(t)}}},6794:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var o=a(28875),n=a(50543),i=a(24839),s=a.n(i);const r="automa-rename-downloaded-files";async function l(){try{return(await s().storage.session.get(r))[r]||{}}catch(e){return console.error("Failed to get downloads from storage:",e),{}}}async function c(e){try{await s().storage.session.set({[r]:e})}catch(e){console.error("Failed to save downloads to storage:",e)}}const d=async function({data:e,id:t}){const a=this.getBlockConnections(t);try{if(!await o.Z.permissions.contains({permissions:["downloads"]})){if(!await o.Z.permissions.request({permissions:["downloads"]}))throw new Error("Download feature requires download permission")}const t={...e,filename:e.filename?.trim()||""};let i=null;if(t.downloadId?.trim()){if(Number.isNaN(+t.downloadId))throw new Error("Download id is not a number");const[e]=await o.Z.downloads.search({id:+t.downloadId});if(!e)throw new Error(`Can't find download item with ${t.downloadId} id`);if("complete"===e.state)return t.saveData&&this.addDataToColumn(t.dataColumn,e.filename),t.assignVariable&&await this.setVariable(t.variableName,e.filename),{nextBlockId:a,data:e.filename};i=+t.downloadId}await async function(){try{if(!await o.Z.permissions.contains({permissions:["downloads"]})&&!await o.Z.permissions.request({permissions:["downloads"]}))throw new Error("Download feature requires download permission");return n.m.sendMessage("downloads:register-listeners",null,"background")}catch(e){throw console.error("Failed to register download listeners:",e),e}}();const s=await new Promise((e=>{if(!this.activeTab.id)throw new Error("no-tab");(async()=>{try{if(i){const o=await l();if(o[i]=t,await c(o),!t.waitForDownload)return void e({nextBlockId:a,data:t.filename});let s=!1,r=t.filename;const d=setTimeout((()=>{s||(s=!0,e({nextBlockId:a,data:r}))}),t.timeout);await n.m.sendMessage("downloads:watch-changed",{downloadId:i,tabId:this.activeTab.id,onComplete:async o=>{try{if(s)return;o.filename&&(r=o.filename),t.saveData&&this.addDataToColumn(t.dataColumn,r),t.assignVariable&&await this.setVariable(t.variableName,r),clearTimeout(d),s=!0,o.downloadId&&await async function(e){try{const t=await l();delete t[e],await c(t)}catch(e){console.error("Failed to remove download from storage:",e)}}(o.downloadId),e({nextBlockId:a,data:r})}catch(t){s||(s=!0,e({nextBlockId:a,data:{$error:!0,message:t.message}}))}}},"background")}else{const o=new Promise((e=>{n.m.sendMessage("downloads:watch-created",{downloadData:t,tabId:this.activeTab.id,onComplete:t=>{e(t)}},"background").catch((t=>{e({error:!0,message:t.message})}))}));if(!t.waitForDownload)return void e({nextBlockId:a,data:t.filename});const i=new Promise((e=>{setTimeout((()=>{e({timedOut:!0,filename:t.filename})}),t.timeout)})),s=await Promise.race([o,i]);let r=t.filename;s.filename&&(r=s.filename),t.saveData&&this.addDataToColumn(t.dataColumn,r),t.assignVariable&&await this.setVariable(t.variableName,r),e({nextBlockId:a,data:r})}}catch(t){e({nextBlockId:a,data:{$error:!0,message:t.message}})}})().catch((t=>{e({nextBlockId:a,data:{$error:!0,message:t.message}})}))}));return s}catch(e){return{nextBlockId:a,data:{$error:!0,message:e.message}}}}},67057:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s,hoverElement:()=>i});var o=a(28875),n=a(72112);async function i(e){if(!this.activeTab.id)throw new Error("no-tab");const{debugMode:t,executedBlockOnWeb:a}=this.settings;return t||await(0,n.xq)(this.activeTab.id),await this._sendMessageToTab({...e,debugMode:t,executedBlockOnWeb:a,activeTabId:this.activeTab.id,frameSelector:this.frameSelector}),t||o.Z.debugger.detach({tabId:this.activeTab.id}),{data:"",nextBlockId:this.getBlockConnections(e.id)}}const s=i},67437:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s,increaseVariable:()=>i});var o=a(81843),n=a.n(o);async function i({id:e,data:t}){const a=this.engine.referenceData.variables;if(!n().has(a,t.variableName))throw new Error(`Cant find "${t.variableName}" variable`);const o=+n().get(a,t.variableName);if(Number.isNaN(o))throw new Error(`The "${t.variableName}" variable value is not a number`);return n().set(this.engine.referenceData.variables,t.variableName,o+t.increaseBy),{data:a[t.variableName],nextBlockId:this.getBlockConnections(e)}}const s=i},34002:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var o=a(15565),n=a(3534),i=a.n(n),s=a(87360),r=a(5072),l=a(87491);const c=async function({id:e,data:t},{refData:a}){const n={};for(const e of t.dataList){let t="";if(e.isFile){const s=await(0,l.Z)(e.filePath||"",a,this.engine.isPopup),c=s.value,d=/.xlsx?$/.test(c),u=c.endsWith(".json"),p=e.action||e.csvAction||"default";let h="text";u?h="json":("base64"===p||d&&"default"!==p)&&(h="blob");let m=await(0,r.Z)(c,{responseType:h,returnValue:!0});const w=p.includes("json");if("base64"===p)m=await(0,r.f)(m);else if(m&&c.endsWith(".csv")&&w){m=i().parse(m,{header:p.includes("header")}).data||[]}else if(d&&w){const t=await(0,r.f)(m),a=(0,o.ij)(t.slice(t.indexOf(",")),{type:"base64"}),n=(e.xlsSheet||"").trim(),i=a.SheetNames.includes(n)?n:a.SheetNames[0],s={};e.xlsRange&&(s.range=e.xlsRange),p.includes("header")||(s.header=1);m=o.P6.sheet_to_json(a.Sheets[i],s)}t=m,Object.assign(n,s.list)}else{const o=await(0,l.Z)(e.value,a,this.engine.isPopup);t=(0,s.Rx)(o.value,o.value),Object.assign(n,o.list)}if("table"===e.type){("string"==typeof t?t.split("||"):[t]).forEach((t=>{this.addDataToColumn(e.name,t)}))}else{const o=await(0,l.Z)(e.name,a,this.engine.isPopup);await this.setVariable(o.value,t)}}return{data:"",replacedValue:n,nextBlockId:this.getBlockConnections(e)}}},76539:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});var o=a(87360),n=a(28875),i=a(72112);const s=async function(e){await async function(e){if("upload-file"===e){if(await n.Z.extension.isAllowedFileSchemeAccess())return!0;throw new Error("no-file-access")}if("clipboard"===e&&!await n.Z.permissions.contains({permissions:["clipboardRead"]}))throw new Error("no-clipboard-acces");return!0}(e.label);const t=(e.data.settings?.debugMode??!1)&&!this.settings.debugMode;try{t&&(await(0,i.xq)(this.activeTab.id),e.debugMode=!0);const a=await this._sendMessageToTab(e,{frameId:this.activeTab.frameId||0});if(e.data.saveData&&"forms"!==e.label||e.data.getValue&&e.data.saveData){const t=this.engine.columns[e.data.dataColumn]?.type||"any",n=t=>{this.addDataToColumn(e.data.dataColumn,t);(0,o.aX)(e.data,"extraRowDataColumn")&&e.data.addExtraRow&&this.addDataToColumn(e.data.extraRowDataColumn,e.data.extraRowValue)};Array.isArray(a)&&"array"!==t?a.forEach((e=>{n(e)})):n(a)}return e.data.assignVariable&&await this.setVariable(e.data.variableName,a),t&&n.Z.debugger.detach({tabId:this.activeTab.id}),{data:a,nextBlockId:this.getBlockConnections(e.id)}}catch(a){throw t&&n.Z.debugger.detach({tabId:this.activeTab.id}),a.data={name:e.label,selector:e.data.selector},a}}},58285:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>w,javascriptCode:()=>m});var o=a(87360),n=a(50543),i=a(92323),s=a.n(i),r=a(96973),l=a(72112),c=a(40234),d=a.n(c);d().selectors.pseudos.equal=d().selectors.createPseudo((function(e){return function(t){return(t.textContent||t.innerText||"").trim()===e}}));new RegExp([":contains",":header",":parent",":equal"].join("|"));function u(e,{type:t,resource:a}){return new Promise(((o,n)=>{if(!t||!["text","json","base64"].includes(t))return void n(new Error('The "type" must be "text" or "json"'));const i=`__automa-fetch-response-${e}__`,s=({detail:t})=>{t.id===e&&(window.removeEventListener(i,s),t.isError?n(new Error(t.result)):o(t.result))};window.addEventListener(i,s),window.dispatchEvent(new CustomEvent("__automa-fetch__",{detail:{id:e,type:t,resource:a}}))}))}const p=(0,r.k)("1234567890abcdef",5);function h({varName:e,refData:t,everyNewTab:a,isEval:o=!1}){let n=`\nconst ${e} = ${JSON.stringify(t)};\n${(0,l.XB)(e)}\nfunction automaSetVariable(name, value) {\n  const variables = ${e}.variables;\n  if (!variables) ${e}.variables = {}\n\n  ${e}.variables[name] = value;\n}\nfunction automaNextBlock(data, insert = true) {\n  if (${o}) {\n    $automaResolve({\n      columns: {\n        data,\n        insert,\n      },\n      variables: ${e}.variables,\n    });\n  } else{\n    document.body.dispatchEvent(new CustomEvent('__automa-next-block__', { detail: { data, insert, refData: ${e} } }));\n  }\n}\nfunction automaResetTimeout() {\n  if (${o}) {\n    clearTimeout($automaTimeout);\n    $automaTimeout = setTimeout(() => {\n      resolve();\n    }, $automaTimeoutMs);\n  } else {\n    document.body.dispatchEvent(new CustomEvent('__automa-reset-timeout__'));\n  }\n}\n${u.toString()}\n\nfunction automaFetch(type, resource) {\n  return automaFetchClient('${e}', { type, resource });\n}\n  `;return a&&(n=(0,l.XB)(e)),n}async function m({outputs:e,data:t,...a},{refData:i}){let r=this.getBlockConnections(a.id);if(t.everyNewTab){if(this.preloadScripts.some((({id:e})=>e===a.id))||this.preloadScripts.push({id:a.id,data:s()(t)}),!this.activeTab.id)return{data:"",nextBlockId:r}}else if(!this.activeTab.id&&"background"!==t.context)throw new Error("no-tab");const c={...a,data:t,refData:{variables:{}},frameSelector:this.frameSelector};if(t.code.includes("automaRefData")){const e={};Object.keys(i).forEach((a=>{t.code.includes(a)&&(e[a]=i[a])})),c.refData={...e,secrets:{}}}const d=(await Promise.allSettled(t.preloadScripts.map((async e=>{const{protocol:t}=new URL(e.src);if(!/https?/.test(t))return null;const a=await fetch(e.src);if(!a.ok)throw new Error(a.statusText);return{script:await a.text(),id:`automa-script-${p()}`,removeAfterExec:e.removeAfterExec}})))).reduce(((e,t)=>("fulfilled"===t.status&&e.push(t.value),e)),[]),u=`automa${p()}`,m=!t.everyNewTab||t.context&&"background"===t.context?h({varName:u,refData:c.refData,everyNewTab:t.everyNewTab}):"";"background"!==t.context&&await(0,l.Hh)({tabId:this.activeTab.id,ms:this.settings?.tabLoadTimeout??3e4});const w=(this.engine.isMV2||this.engine.isPopup)&&"background"===t.context,f=await(w?(0,l.k$)("javascriptBlock",{instanceId:u,preloadScripts:d,refData:c.refData,blockData:s()(c.data)}):async function(e,t,a){if(!t.tabId)throw new Error("no-tab");if(a.engine.isMV2)return e[0]=s()(e[0]),await a._sendMessageToTab({label:"javascript-code",data:e});const{debugMode:i}=a.engine.workflow.settings,r=`\n    function() {\n      try {\n        // \n        const _blockData = ${JSON.stringify(e[0])};\n        const _preloadScripts = ${JSON.stringify(e[1])};\n        const _varName = ${JSON.stringify(e[3])};\n\n        // \n        const _automaScript = (function(_varName, _refData, _everyNewTab, _isEval) {\n          // getAutomaScript\n          const _automaRefDataStr = function(_varName) {\n            return \`\n              function findData(obj, path) {\n                const paths = path.split('.');\n                const isWhitespace = paths.length === 1 && !/\\\\S/.test(paths[0]);\n                if (path.startsWith('$last') && Array.isArray(obj)) {\n                  paths[0] = obj.length - 1;\n                }\n                if (paths.length === 0 || isWhitespace) return obj;\n                else if (paths.length === 1) return obj[paths[0]];\n                let result = obj;\n                for (let i = 0; i < paths.length; i++) {\n                  if (result[paths[i]] == undefined) {\n                    return undefined;\n                  } else {\n                    result = result[paths[i]];\n                  }\n                }\n                return result;\n              }\n              function automaRefData(keyword, path = '') {\n                const data = \${_varName}[keyword];\n                if (!data) return;\n                return findData(data, path);\n              }\n            \`;\n          };\n\n          let _str = \`\n            const \${_varName} = \${JSON.stringify(_refData)};\n            \${_automaRefDataStr(_varName)}\n            function automaSetVariable(name, value) {\n              const variables = \${_varName}.variables;\n              if (!variables) \${_varName}.variables = {}\n              \${_varName}.variables[name] = value;\n            }\n            function automaNextBlock(data, insert = true) {\n              if (\${_isEval}) {\n                $automaResolve({\n                  columns: {\n                    data,\n                    insert,\n                  },\n                  variables: \${_varName}.variables,\n                });\n              } else{\n                document.body.dispatchEvent(new CustomEvent('__automa-next-block__', { detail: { data, insert, refData: \${_varName} } }));\n              }\n            }\n            function automaResetTimeout() {\n              if (\${_isEval}) {\n                clearTimeout($automaTimeout);\n                $automaTimeout = setTimeout(() => {\n                  resolve();\n                }, $automaTimeoutMs);\n              } else{\n                document.body.dispatchEvent(new CustomEvent('__automa-reset-timeout__'));\n              }\n            }\n            function automaFetchClient(id, { type, resource }) {\n              return new Promise((resolve, reject) => {\n                const validType = ['text', 'json', 'base64'];\n                if (!type || !validType.includes(type)) {\n                  reject(new Error('The "type" must be "text" or "json"'));\n                  return;\n                }\n                const eventName = \\\`__automa-fetch-response-\\\${id}__\\\`;\n                const eventListener = ({ detail }) => {\n                  if (detail.id !== id) return;\n                  window.removeEventListener(eventName, eventListener);\n                  if (detail.isError) {\n                    reject(new Error(detail.result));\n                  } else {\n                    resolve(detail.result);\n                  }\n                };\n                window.addEventListener(eventName, eventListener);\n                window.dispatchEvent(\n                  new CustomEvent(\\\`__automa-fetch__\\\`, {\n                    detail: {\n                      id,\n                      type,\n                      resource,\n                    },\n                  })\n                );\n              });\n            }\n            function automaFetch(type, resource) {\n              return automaFetchClient('\${_varName}', { type, resource });\n            }\n          \`;\n\n          if (_everyNewTab) _str = _automaRefDataStr(_varName);\n\n          return _str;\n        })(_varName, _blockData.refData, _blockData.data.everyNewTab, true);\n\n        // JavaScript\n        const _jsCode = (function(_blockData, _automaScript, _preloadScripts) {\n          // jsContentHandlerEval\n          const _preloadScriptsStr = _preloadScripts\n            .map(function(item) { return item.script; })\n            .join('\\n');\n\n          return \`(() => {\n            \${_preloadScriptsStr}\n            return new Promise(($automaResolve) => {\n              const $automaTimeoutMs = \${_blockData.data.timeout};\n              let $automaTimeout = setTimeout(() => {\n                $automaResolve();\n              }, $automaTimeoutMs);\n              \${_automaScript}\n              try {\n                \${_blockData.data.code}\n                \${\n                  _blockData.data.code.includes('automaNextBlock')\n                    ? ''\n                    : 'automaNextBlock()'\n                }\n              } catch (error) {\n                return { columns: { data: { $error: true, message: error.message } } };\n              }\n            }).catch((error) => {\n              return { columns: { data: { $error: true, message: error.message } } };\n            });\n          })();\`;\n        })(_blockData, _automaScript, _preloadScripts);\n\n        return _jsCode;\n      } catch (error) {\n        console.error(':', error);\n        throw error;\n      }\n    }\n  `,c=await(0,l.uh)({target:t,debugMode:i},r);if(c.isBlocked)return c.value;const{0:d,1:u,3:p}=e,[{result:h}]=await n.m.sendMessage("script:execute",{target:t,blockData:d,preloadScripts:u,varName:p},"background");return"string"==typeof h?.columns?.data&&(h.columns.data=(0,o.Rx)(h.columns.data,{})),h}([c,d,m,u],{tabId:this.activeTab.id,frameIds:[this.activeTab.frameId||0]},this));if(f){if(f.columns.data?.$error)throw new Error(f.columns.data.message);f.variables&&await Promise.allSettled(Object.keys(f.variables).map((async e=>{await this.setVariable(e,f.variables[e])})));let e=!0,t=!1;if((0,o.Kn)(f.columns.insert)){const{insert:a,nextBlockId:o,replaceTable:n}=f.columns.insert;if(t=Boolean(n),e="boolean"!=typeof a||a,o){let e=this.getBlockConnections(o);const t=this.engine.blocks[o];if(!e&&t&&(e=[{id:o,blockId:o,connections:new Map([])}]),!e)throw new Error(`Can't find block with "${o}" id`);r=e}}else e=f.columns.insert;const a=f.columns.data;if(e&&a){const e="string"==typeof a?(0,o.Rx)(a,null):a;if(e){const a=Array.isArray(e)?e:[e];t&&(this.engine.referenceData.table=[],Object.keys(this.engine.columns).forEach((e=>{this.engine.columns[e].index=0}))),this.addDataToColumn(a)}}}return{nextBlockId:r,data:f?.columns.data||{}}}const w=m},11885:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});var o=a(28875);async function n({data:e,id:t,label:a}){const n=await this._sendMessageToTab({id:t,data:e,label:a});if(e.openInNewTab){const e=await o.Z.tabs.create({url:n,windowId:this.activeTab.windowId});this.activeTab.url=n,this.activeTab.frameId=0,this.activeTab.id=e.id}return{data:n,nextBlockId:this.getBlockConnections(t)}}},91215:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m,logData:()=>h});var o=a(81102),n=a(34983),i=a(10722),s=a(57692);const r=(0,i.o)({legacy:!1,fallbackLocale:"en"});const l=r;var c=a(87360);const d=(0,o.V)();function u(e){const t={...e},a=(e,t)=>{const a="string"==typeof e?{path:e}:e;return l.global.te(a.path)?l.global.t(a.path,a.params):t};return["finish","stop"].includes(e.type)?t.name=l.global.t(`log.types.${e.type}`):t.name=a(`workflow.blocks.${e.name}.name`,d[e.name].name),t.message&&s.ND.includes(t.message)&&(t.messageId=`${t.message}`),t.message=a({path:`log.messages.${e.message}`,params:e},e.message),t}function p(e,t="plain-text"){const{logs:a,ctxData:o}=e,i=function(e,t,a){let o="plain-text"===e?"":[];const i={"plain-text":([e,t,a,n,i,s,r])=>{o+=`${e}(${(0,c.g9)(0,t||0).trim()}) - ${a} - ${n} - ${i} - ${s} - ${JSON.stringify(r)} \n`},json:([e,t,a,n,i,s,r])=>{o.push({timestamp:e,duration:(0,c.g9)(0,t||0).trim(),status:a,name:n,description:i,message:s,data:r})}};return t.forEach(((t,o)=>{let s=a;s.ctxData&&(s=s.ctxData);const r=s[t.id]||null;r&&function(e,t){if(!e?.dataSnapshot)return;const a=e.dataSnapshot,o=e=>{const o=t[e];return"string"!=typeof o?o:a[o]??{}};t.loopData=o("loopData"),t.variables=o("variables")}(a,r.referenceData),i[e]([(0,n.Z)(t.timestamp||Date.now()).format("YYYY-MM-DD HH:mm:ss"),t.duration,t.type.toUpperCase(),t.name,t.description||"NULL",t.message||"NULL",r],o)})),o}(t,a.map(u),o);return i}async function h({id:e,data:t}){if(!t.workflowId)throw new Error("No workflow is selected");const{states:a}=this.engine.states;let o=[];if(a){const e=Object.values(Object.fromEntries(a)),n=e.find((e=>e.workflowId===t.workflowId))?.state;n&&(o=p(n,"json"),t.assignVariable&&await this.setVariable(t.variableName,o),t.saveData&&this.addDataToColumn(t.dataColumn,o))}return{data:o,nextBlockId:this.getBlockConnections(e)}}const m=h},84588:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});var o=a(72112);const n=async function(e,{prevBlockData:t}){const a=this.loopList[e.data.loopId];let n=!1;if(!a)throw new Error(`Can't find a loop with "${e.data.loopId}" loop id`);n="numbers"===a.type||a.index<a.data.length-1;const i=!(a&&a.maxLoop>0)||a.index<a.maxLoop-1;if(!e.data.clearLoop&&n&&i)return{data:"",nextBlockId:[{id:a.blockId}]};if("elements"===a.type){if(a.loadMoreAction&&i){const t="click-link"===a.loadMoreAction.type;let n=await this._sendMessageToTab({id:a.blockId,label:"loop-elements",data:{...a.loadMoreAction,index:a.index,onlyClickLink:t}});if(!n.continue&&t&&(await(0,o.Hh)({tabId:this.activeTab.id,ms:1e3*a.loadMoreAction.actionPageMaxWaitTime}),n=await this._sendMessageToTab({id:a.blockId,label:"loop-elements",data:{...a.loadMoreAction,index:a.index}})),!n.continue&&n.length>0)return this.loopList[e.data.loopId].data.push(...n),{data:"",nextBlockId:[{id:a.blockId}]}}const t=this.loopEls.findIndex((({blockId:e})=>e===a.blockId));-1!==t&&this.loopEls.splice(t,1)}return delete this.loopList[e.data.loopId],delete this.engine.referenceData.loopData[e.data.loopId],this.engine.addRefDataSnapshot("loopData"),{data:t,nextBlockId:this.getBlockConnections(e.id)}}},58006:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});var o=a(81843),n=a.n(o),i=a(87360);const s=async function({data:e,id:t},{refData:a}){try{if(this.loopList[e.loopId]){const t=this.loopList[e.loopId].index+1;let o;this.loopList[e.loopId].index=t,o="numbers"===e.loopThrough?a.loopData[e.loopId].data+1:this.loopList[e.loopId].data[t],a.loopData[e.loopId]={data:o,$index:t}}else{const o=+e.maxLoop||0,s={numbers:()=>e.fromNumber,table:()=>a.table,"custom-data":()=>JSON.parse(e.loopData),"data-columns":()=>a.table,"google-sheets":()=>a.googleSheets[e.referenceKey],variable:()=>{let t=n().get(a.variables,e.variableName);if(Array.isArray(t))return t;switch(t=(0,i.Rx)(t,t),typeof t){case"string":t=t.split("");break;case"number":t=Array.from({length:t},((e,t)=>t+1))}return t},elements:async()=>{const a=(0,i.mq)(e.elementSelector)?"xpath":"cssSelector",{elements:n,url:s,loopId:r}=await this._sendMessageToTab({id:t,label:"loop-data",data:{findBy:a,max:o,multiple:!0,reverseLoop:e.reverseLoop,selector:e.elementSelector,waitForSelector:e.waitForSelector??!1,waitSelectorTimeout:e.waitSelectorTimeout??5e3}});return this.loopEls.push({url:s,loopId:r,findBy:a,max:o,blockId:t,selector:e.elementSelector}),n}},r=await s[e.loopThrough]();let l=0;if("numbers"!==e.loopThrough){if(!Array.isArray(r))throw new Error("invalid-loop-data");const a=+e.startIndex;e.resumeLastWorkflow&&this.engine.isPopup?l=JSON.parse(localStorage.getItem(`index:${t}`))||0:!Number.isNaN(a)&&a>0&&(l=a),e.reverseLoop&&"elements"!==e.loopThrough&&r.reverse()}this.loopList[e.loopId]={index:l,blockId:t,id:e.loopId,data:r,type:e.loopThrough,maxLoop:"numbers"===e.loopThrough?e.toNumber+1-e.fromNumber:o},a.loopData[e.loopId]={data:"numbers"===e.loopThrough?e.fromNumber:r[l],$index:l},this.engine.addRefDataSnapshot("loopData")}return this.engine.isPopup&&localStorage.setItem(`index:${t}`,this.loopList[e.loopId].index),{data:a.loopData[e.loopId],nextBlockId:this.getBlockConnections(t)}}catch(t){throw"elements"===e.loopThrough&&(t.data={selector:e.elementSelector}),t}}},95277:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});const o=async function({data:e,id:t},{refData:a}){try{if(!this.activeTab.id)throw new Error("no-tab");if(this.loopList[e.loopId]){const t=this.loopList[e.loopId].index+1;this.loopList[e.loopId].index=t,a.loopData[e.loopId]={$index:t,data:this.loopList[e.loopId].data[t]}}else{const o=+e.maxLoop||0,{elements:n,url:i,loopId:s}=await this._sendMessageToTab({id:t,label:"loop-data",data:{max:o,multiple:!0,...e}});this.loopEls.push({url:i,loopId:s,max:o,blockId:t,findBy:e.findBy,selector:e.selector});const r={maxLoop:o,index:0,blockId:t,data:n,id:e.loopId,type:"elements"};"none"!==e.loadMoreAction&&(r.loadMoreAction={maxLoop:o,loopAttrId:s,loopId:e.loopId,findBy:e.findBy,type:e.loadMoreAction,selector:e.selector.trim(),scrollToBottom:e.scrollToBottom,actionElMaxWaitTime:e.actionElMaxWaitTime,actionElSelector:e.actionElSelector.trim(),actionPageMaxWaitTime:e.actionPageMaxWaitTime}),this.loopList[e.loopId]=r,a.loopData[e.loopId]={$index:0,data:n[0]}}return{data:a.loopData[e.loopId],nextBlockId:this.getBlockConnections(t)}}catch(t){throw"element-not-found"===t?.message&&(t.data={selector:e.selector}),t}}},53489:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var o=a(28875),n=a(87360),i=a(24839),s=a.n(i),r=a(72112);const l=async function({id:e,data:t}){if(this.windowId)try{await o.Z.windows.get(this.windowId)}catch(e){this.windowId=null}else await s().runtime.sendMessage({name:"background--browser-api",data:{name:"windows.getCurrent"}}).then((e=>(this.windowId=e.id,Promise.resolve(e))));if(!function(e){try{return new URL(e),!0}catch(e){return!1}}(t.url)){const e=new Error((0,n.cb)(t.url)?"url-empty":"invalid-active-tab");throw e.data={url:t.url},e}let a=null;if(a=t.updatePrevTab&&this.activeTab.id?await o.Z.tabs.update(this.activeTab.id,{url:t.url,active:t.active}):await o.Z.tabs.create({url:t.url,active:t.active,windowId:this.windowId}),this.activeTab.url=t.url,a&&((this.settings.debugMode||t.customUserAgent)&&(await(0,r.xq)(a.id,this.activeTab.id),this.debugAttached=!0,t.customUserAgent&&(await(0,r.k)(a.id,"Network.setUserAgentOverride",{userAgent:t.userAgent}),await o.Z.tabs.reload(a.id),await(0,n._v)(1e3))),t.tabZoom&&1!==t.tabZoom&&(await(0,n._v)(1e3),await o.Z.tabs.setZoom(a.id,t.tabZoom)),this.activeTab.id=a.id,this.windowId=a.windowId),t.inGroup&&!t.updatePrevTab){const e={groupId:this.activeTab.groupId,tabIds:this.activeTab.id};this.activeTab.groupId||(e.createProperties={windowId:this.windowId}),o.Z.tabs.group(e,(e=>{this.activeTab.groupId=e}))}return this.activeTab.frameId=0,!this.settings.debugMode&&t.customUserAgent&&o.Z.debugger.detach({tabId:a.id}),this.preloadScripts.length>0&&(this.engine.isMV2?await this._sendMessageToTab({isPreloadScripts:!0,label:"javascript-code",data:{scripts:this.preloadScripts}}):await(0,r.SR)({scripts:this.preloadScripts,frameSelector:this.frameSelector,target:{tabId:this.activeTab.id,frameIds:[this.activeTab.frameId||0]}})),t.waitTabLoaded&&await(0,r.Hh)({listenError:!0,tabId:this.activeTab.id,ms:this.settings?.tabLoadTimeout??3e4}),await o.Z.windows.update(a.windowId,{focused:!0}),{data:t.url,nextBlockId:this.getBlockConnections(e)}}},86277:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s,newWindow:()=>i});var o=a(28875),n=a(72112);async function i({data:e,id:t}){const a={state:e.windowState,incognito:e.incognito,type:e.type||"normal"};"normal"===e.windowState&&["top","left","height","width"].forEach((t=>{e[t]<=0||(a[t]=e[t])})),e.url&&(a.url=e.url);const i=await o.Z.windows.create(a);if(this.windowId=i.id,e.url){const[e]=i.tabs;this.settings.debugMode&&await(0,n.xq)(e.id,this.activeTab.id),this.activeTab.id=e.id,this.activeTab.url=e.url}return{data:i.id,nextBlockId:this.getBlockConnections(t)}}const s=i},49304:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var o=a(28875),n=a(67197);async function i({data:e,id:t}){if(!await o.Z.permissions.contains({permissions:["notifications"]})){const e=new Error("no-permission");throw e.data={permission:"notifications"},e}const a={title:e.title,message:e.message,iconUrl:o.Z.runtime.getURL("icon-128.png")};return["iconUrl","imageUrl"].forEach((t=>{const o=e[t];o&&o.startsWith("http")&&(a[t]=o)})),await o.Z.notifications.create((0,n.x0)(),{...a,type:a.imageUrl?"image":"basic"}),{data:"",nextBlockId:this.getBlockConnections(t)}}},95973:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});var o=a(28875),n=a(87360),i=a(96973),s=a(87491);async function r({data:e,id:t},{refData:a}){const r=o.Z.runtime.getURL("/params.html");let l=(await o.Z.tabs.query({})).find((e=>e.url.includes(r)));if(l)await o.Z.tabs.update(l.id,{active:!0}),await o.Z.windows.update(l.windowId,{focused:!0});else{const{tabs:e}=await o.Z.windows.create({type:"popup",width:480,height:600,url:o.Z.runtime.getURL("/params.html")});[l]=e,await(0,n._v)(1e3)}const c=`params-prompt:${(0,i.x)(4)}__${t}`,{timeout:d}=e,u=await Promise.all(e.parameters.map((e=>async function(e,t,a){const o={};return await Promise.allSettled(["defaultValue","description","placeholder"].map((async n=>{e[n]&&(o[n]=(await(0,s.Z)(e[n],t,a)).value)}))),{...e,...o}}(e,a,this.engine.isPopup))));await o.Z.tabs.sendMessage(l.id,{name:"workflow:params-block",data:{params:u,promptId:c,blockId:t,timeoutMs:d,execId:this.engine.id,timeout:Date.now()+d,name:this.engine.workflow.name,icon:this.engine.workflow.icon,description:this.engine.workflow.description}});const p=await function(e,t=1e4){return new Promise(((a,n)=>{const i=t=>{if(!t[e])return;clearTimeout(null),o.Z.storage.onChanged.removeListener(i),o.Z.storage.local.remove(e);const{newValue:s}=t[e];s.$isError?n(new Error(s.message)):a(s)};t>0&&setTimeout((()=>{o.Z.storage.onChanged.removeListener(i),a({})}),t),o.Z.storage.onChanged.addListener(i)}))}(c,d);return await Promise.allSettled(Object.entries(p).map((async([e,t])=>this.setVariable(e,t)))),{data:"",nextBlockId:this.getBlockConnections(t)}}},75249:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var o=a(87360),n=a(28875);const i=function({data:e,id:t}){const a=this.getBlockConnections(t);return new Promise(((t,i)=>{e.clearProxy&&n.Z.proxy.settings.clear({});const s={mode:"fixed_servers",rules:{singleProxy:{scheme:e.scheme},bypassList:(0,o.cb)(e.bypassList)?[]:e.bypassList.split(",")}};let r=e.port;if((0,o.cb)(e.host)){if(e.clearProxy)return this.engine.isUsingProxy=!1,void t({data:"",nextBlockId:a});const o=new Error("invalid-proxy-host");return o.nextBlockId=a,void i(o)}{let t=e.host;if(/^https?|socks4|socks5/i.test(e.host)){let[a,o]=e.host.split(/:\/\/(.*)/);o.includes(":")&&([o,r]=o.split(":")),t=o,s.rules.singleProxy.scheme=a}s.rules.singleProxy.host=t}r&&!Number.isNaN(+r)&&(s.rules.singleProxy.port=+r),n.Z.proxy.settings.set({value:s,scope:"regular"}).then((()=>{this.engine.isUsingProxy=!0,t({data:e.host,nextBlockId:a})}))}))}},22743:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s,regexVariable:()=>i});var o=a(81843),n=a.n(o);async function i({id:e,data:t}){const a=this.engine.referenceData.variables;if(!n().has(a,t.variableName))throw new Error(`Cant find "${t.variableName}" variable`);const o=n().get(a,t.variableName);if("string"!=typeof o)throw new Error(`The value of the "${t.variableName}" variable is not a string/text`);const i=t.method||"match",s=new RegExp(t.expression,t.flag.join(""));let r="";if("match"===i){const e=o.match(s);r=e&&!t.flag.includes("g")?e[0]:e}else"replace"===i&&(r=o.replace(s,t.replaceVal??""));return n().set(this.engine.referenceData.variables,t.variableName,r),{data:r,nextBlockId:this.getBlockConnections(e)}}const s=i},22654:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i,reloadTab:()=>n});var o=a(28875);async function n({id:e}){if(!this.activeTab.id)throw new Error("no-tab");return await o.Z.tabs.reload(this.activeTab.id),{data:"",nextBlockId:this.getBlockConnections(e)}}const i=n},45926:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});const o=function({data:e,id:t}){return new Promise((a=>{const o=Number.isNaN(+e.repeatFor)?0:+e.repeatFor;this.repeatedTasks[t]>o||!this.getBlockConnections(t,2)?(delete this.repeatedTasks[t],a({data:o,nextBlockId:this.getBlockConnections(t)})):(this.repeatedTasks[t]=(this.repeatedTasks[t]||1)+1,a({data:o,nextBlockId:this.getBlockConnections(t,2)}))}))}},92160:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});var o=a(28875);async function n({data:e,id:t,label:a}){if(!await o.Z.permissions.contains({permissions:["downloads"]})){const e=new Error("no-permission");throw e.data={permission:"downloads"},e}let n=[e.url],i=0;const s=t=>{const a={url:t,conflictAction:e.onConflict};let n=decodeURIComponent(e.filename||function(e){try{const t=new URL(e).pathname.split("/").pop();return/\.[0-9a-z]+$/i.test(t)?t:null}catch(e){return null}}(t));return n&&("overwrite"===e.onConflict&&0!==i&&(n=`(${i}) ${n}`),a.filename=n,i+=1),o.Z.downloads.download(a)};let r=null;return"element"===e.type?(n=await this._sendMessageToTab({id:t,data:e,label:a,tabId:this.activeTab.id}),r=await Promise.all(n.map((e=>s(e))))):"url"===e.type&&(r=[await s(e.url)]),e.saveDownloadIds&&(e.assignVariable&&await this.setVariable(e.variableName,r),e.saveData&&this.addDataToColumn(e.dataColumn,r)),{data:{sources:n,downloadIds:r},nextBlockId:this.getBlockConnections(t)}}},73935:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s,sliceData:()=>i});var o=a(81843),n=a.n(o);async function i({id:e,data:t}){const a=n().get(this.engine.referenceData.variables,t.variableName),o={data:a,nextBlockId:this.getBlockConnections(e)};if(!a||!a?.slice)return o;let i=0,s=a.length;t.startIdxEnabled&&(i=t.startIndex),t.endIdxEnabled&&(s=t.endIndex);const r=a.slice(i,s);return o.data=r,n().set(this.engine.referenceData.variables,t.variableName,r),o}const s=i},68012:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i,sliceData:()=>n});var o=a(87360);async function n({id:e,data:t}){let a=null;if("table"===t.dataSource)a=this.engine.referenceData.table;else if("variable"===t.dataSource){const{variables:e}=this.engine.referenceData;if(!(0,o.aX)(e,t.varSourceName))throw new Error(`Cant find "${t.varSourceName}" variable`);a=e[t.varSourceName]}if(!Array.isArray(a)){throw new Error(`Can't sort data with "${null===a?"null":typeof a}" data type`)}const n=({itemA:e,itemB:t,order:a="asc"})=>{let o=0;return e>t?o=1:e<t&&(o=-1),"desc"===a?-1*o:o},i=a.sort(((e,a)=>{let o=0;return t.sortByProperty?t.itemProperties.forEach((({name:t,order:i})=>{o=n({order:i,itemA:e[t]??e,itemB:a[t]??a})})):o=n({itemA:e,itemB:a}),o}));return t.assignVariable&&await this.setVariable(t.variableName,i),t.saveData&&this.addDataToColumn(t.dataColumn,i),{data:i,nextBlockId:this.getBlockConnections(e)}}const i=n},32821:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var o=a(28875),n=a(72112);async function i({data:e,id:t}){const a=this.getBlockConnections(t),i=(e,t)=>{const o=new Error(e);return o.nextBlockId=a,t&&(o.data=t),o};this.windowId=null;let s=null;const r=e.activeTab??!0,l=e.findTabBy||"match-patterns",c=["next-tab","prev-tab"].includes(l);if(!this.activeTab.id&&c)throw new Error("no-tab");const d="match-patterns"!==l?await o.Z.tabs.query({}):[];if(["match-patterns","tab-title"].includes(l)){const t={};if("match-patterns"===e.findTabBy?t.url=e.matchPattern:"tab-title"===e.findTabBy&&(t.title=e.tabTitle),[s]=await o.Z.tabs.query(t),!s){if(!e.createIfNoMatch)throw i("no-match-tab",{pattern:e.matchPattern});if(!e.url.startsWith("http"))throw i("invalid-active-tab",{url:e.url});s=await o.Z.tabs.create({url:e.url,active:r,windowId:this.windowId})}}else if(c){const e=l.includes("next")?1:-1;let t=d.findIndex((e=>e.id===this.activeTab.id));t+=e,t<0?t=d.length-1:t>d.length-1&&(t=0),s=d[t]}else if("tab-index"===l&&(s=d[e.tabIndex],!s))throw i(`Can't find a tab with ${e.tabIndex} index`);return await o.Z.tabs.update(s.id,{active:r}),this.activeTab.id=s.id,this.activeTab.frameId=0,this.activeTab.url=s.url,this.windowId=s.windowId,this.settings.debugMode&&(await(0,n.xq)(s.id,this.activeTab.id),this.debugAttached=!0),this.preloadScripts.length>0&&(this.engine.isMV2?await this._sendMessageToTab({isPreloadScripts:!0,label:"javascript-code",data:{scripts:this.preloadScripts}}):await(0,n.SR)({scripts:this.preloadScripts,frameSelector:this.frameSelector,target:{tabId:this.activeTab.id,frameIds:[this.activeTab.frameId||0]}})),r&&await o.Z.windows.update(s.windowId,{focused:!0}),{nextBlockId:a,data:s.url}}},2692:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var o=a(87360),n=a(72112);const i=async function(e){const t=this.getBlockConnections(e.id);try{if("main-window"===e.data.windowType)return this.activeTab.frameId=0,delete this.frameSelector,{data:"",nextBlockId:t};const{url:a,isSameOrigin:i}=await this._sendMessageToTab(e,{frameId:0});if(i)return this.frameSelector=e.data.selector,{data:e.data.selector,nextBlockId:t};const s=await(0,n.Xs)(this.activeTab.id);let r=s[a]??null;if(null===r&&(r=Object.entries(s).find((([e])=>{try{const t=new URL(a).pathname;return t===new URL(e).pathname}catch(e){return!1}}))?.[1]),null!==r)return this.activeTab.frameId=r,await(0,o._v)(1e3),{nextBlockId:t,data:this.activeTab.frameId};throw new Error("no-iframe-id")}catch(a){throw a.data={selector:e.data.selector},a.nextBlockId=t,a}}},57726:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i,logData:()=>n});var o=a(28875);async function n({id:e,data:t}){let a=[];if("active-tab"===t.type){if(!this.activeTab.id)throw new Error("no-tab");const e=await o.Z.tabs.get(this.activeTab.id);a=e.url||e.pendingUrl||""}else{const e={};t.qMatchPatterns&&(e.url=t.qMatchPatterns),t.qTitle&&(e.title=t.qTitle);a=(await o.Z.tabs.query(e)).map((e=>e.url))}return t.assignVariable&&await this.setVariable(t.variableName,a),t.saveData&&this.addDataToColumn(t.dataColumn,a),{data:a,nextBlockId:this.getBlockConnections(e)}}const i=n},71103:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});var o=a(87360),n=a(28875),i=a(2518),s=a(72112);const r=async function({data:e,id:t,label:a}){const r=void 0===e.saveToComputer||e.saveToComputer;try{let l=null;const c={quality:e.quality,format:e.ext||"png"},d=async t=>{e.saveToColumn&&this.addDataToColumn(e.dataColumn,t),r&&await async function({filename:e,uri:t,ext:a}){const i=await n.Z.permissions.contains({permissions:["downloads"]}),s=`${e||"Screenshot"}.${a||"png"}`;if(i)return void await n.Z.downloads.download({url:t,filename:s});const r=new Image;r.onload=()=>{const e=document.createElement("canvas");e.width=r.width,e.height=r.height,e.getContext("2d").drawImage(r,0,0),(0,o.AG)(s,e.toDataURL())},r.src=t}({filename:e.fileName,uri:t,ext:e.ext}),e.assignVariable&&await this.setVariable(e.variableName,t)};if(e.captureActiveTab){if(!this.activeTab.id)throw new Error("no-tab");let t=null;const o=!i.D,r=async()=>{let e=null;if(o){const t=await n.Z.tabs.get(this.activeTab.id);e=await n.Z.tabs.captureVisibleTab(t.windowId,c)}else e=await n.Z.tabs.captureTab(this.activeTab.id,c);return e};o&&([t]=await n.Z.tabs.query({active:!0,url:"*://*/*"}),this.windowId&&await n.Z.windows.update(this.windowId,{focused:!0})),await n.Z.tabs.update(this.activeTab.id,{active:!0}),await(0,s.Hh)({tabId:this.activeTab.id,listenError:!0}),l=await(e.fullPage||["element","fullpage"].includes(e.type)?this._sendMessageToTab({label:a,options:c,data:{type:e.type,selector:e.selector},tabId:this.activeTab.id}):r()),t&&(await n.Z.windows.update(t.windowId,{focused:!0}),await n.Z.tabs.update(t.id,{active:!0})),await d(l)}else l=await n.Z.tabs.captureVisibleTab(c),await d(l);return{data:l,nextBlockId:this.getBlockConnections(t)}}catch(t){throw"element"===e.type&&(t.data={selector:e.selector}),t}}},20692:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});const o=async function(e){return new Promise((t=>{t({data:"",nextBlockId:this.getBlockConnections(e.id)})}))}},70980:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});const o=async function({data:e,id:t},{prevBlock:a}){return new Promise(((o,n)=>{let i,s=!1;const r=this.getBlockConnections(t),l=e.specificFlow&&a?.id!==e.flowBlockId,c=()=>{const e=this.engine.connectionsMap;Object.keys(e).forEach((a=>{if(![...e[a].values()].some((e=>e.id===t)))return;const o=a.indexOf("-output"),n=a.slice(0,-1===o?a.length:o);this.engine.waitConnections[t][n]={isHere:!1,isContinue:!1}}))},d=()=>{if(s)return;const u=Object.values(this.engine.waitConnections[t]);if(u.every((e=>e.isHere))){this.engine.waitConnections[t][a.id].isContinue=!0;if(u.every((e=>e.isContinue))&&c(),clearTimeout(i),e.specificFlow&&e.flowBlockId){if(!Object.keys(this.engine.waitConnections[t]).includes(e.flowBlockId))return void n(new Error("No specific flow selected"))}o({data:"",nextBlockId:r,destroyWorker:l})}else setTimeout((()=>{d()}),1e3)};this.engine.waitConnections[t]||(this.engine.waitConnections[t]={},c()),this.engine.waitConnections[t][a.id].isHere=!0,i=setTimeout((()=>{s=!0,o({data:"",nextBlockId:r,destroyWorker:l})}),e.timeout),d()}))}},50460:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m,webhook:()=>h});var o=a(81843),n=a.n(o),i=a(87360),s=a(5072);const r=async(e,t)=>{if("text"===t)return e;const a=(0,i.Rx)(e,new Error("invalid-body"));if(a instanceof Error)throw a;if("form"===t)return new URLSearchParams(a);if("form-data"===t){if(!Array.isArray(a)||!Array.isArray(a[0]))throw new Error("The body must be 2D Array");const e=new FormData;for(const t of a){const[a,o,n]=t,i=/\.(.*)/.test(o)&&!0,r=o.startsWith("http");let l=o,c=n;if(i||r){if(l=await(0,s.Z)(o,{returnValue:!0}),c||(c=o.split("/").pop()),!l)throw new Error("File not found")}else{let e="";e=o.includes("base64")?o:`data:text/plain;base64,${window.btoa(o)}`;const t=await fetch(e);l=await t.blob()}const d=[a,l];c&&d.push(c),e.append(...d)}return e}return JSON.stringify(a)},l=e=>{const t={};return e&&Array.isArray(e)?(e.forEach((e=>{e.name&&e.value&&(t[e.name]=e.value)})),t):t},c={text:"text/plain",json:"application/json","form-data":"multipart/form-data",form:"application/x-www-form-urlencoded"},d=["GET","HEAD"];var u=a(87491);const p="$response";async function h({data:e,id:t},{refData:a}){const o=this.getBlockConnections(t),s=this.getBlockConnections(t,"fallback");try{if((0,i.cb)(e.url))throw new Error("url-empty");if(!e.url.startsWith("http")){const t=new Error("invalid-active-tab");throw t.data={url:e.url},t}const t=[];for(const{value:o,name:n}of e.headers){const e=(await(0,u.Z)(o,a,this.engine.isPopup)).value;t.push({name:n,value:e})}const h=await async function({url:e,contentType:t,headers:a,timeout:o,body:n,method:s}){let u=null,p=null;o>0&&(p=new AbortController,u=setTimeout((()=>{p.abort()}),o));try{const o=l(a);"form-data"!==t&&(o["Content-Type"]=c[t||"json"]);const h={headers:o,method:s||"POST"};p&&(h.signal=p.signal),d.includes(s||"POST")||(0,i.cb)(n)||(h.body=await r(n,t));const m=await fetch(e,h);return u&&clearTimeout(u),m}catch(e){throw u&&clearTimeout(u),e}}({...e,headers:t});if(!h.ok){const{status:t,statusText:a}=h,o={ctxData:{request:{status:t,statusText:a,data:await("json"===e.responseType?h.json():h.text())}}};if(s&&s.length>0)return{ctxData:o,data:"",nextBlockId:s};const n=new Error(`(${h.status}) ${h.statusText}`);throw n.ctxData=o,n}if(!e.assignVariable&&!e.saveData)return{data:"",nextBlockId:o};const m=e.dataPath.includes(p);let w="";if("json"===e.responseType){const t=await h.json();w=m?t:n().get(t,e.dataPath)}else if("base64"===e.responseType){const e=await h.blob();w=await new Promise((t=>{const a=new FileReader;a.onload=()=>{t(a.result)},a.readAsDataURL(e)}))}else w=await h.text();if(m){const{status:t,statusText:a,url:o,redirected:i,ok:s}=h,r={ok:s,url:o,status:t,statusText:a,redirected:i,data:w};w=n().get({$response:r},e.dataPath)}return e.assignVariable&&await this.setVariable(e.variableName,w),e.saveData&&("$assignColumns"===e.dataColumn&&Array.isArray(w)?this.addDataToColumn(w):this.addDataToColumn(e.dataColumn,w)),{nextBlockId:o,data:w}}catch(e){if(s&&["Failed to fetch","user aborted"].some((t=>e.message.includes(t))))return{data:"",nextBlockId:s};throw e.nextBlockId=o,e}}const m=h},90997:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var o=a(13282),n=a(76678);const i=async function({data:e,id:t},{refData:a}){const{debugMode:i}=this.engine.workflow?.settings||{},s={refData:a,isMV2:this.engine.isMV2,isPopup:this.engine.isPopup,activeTab:this.activeTab.id,checkCodeCondition:e=>(e.debugMode=i,(0,n.Z)(this.activeTab,e)),sendMessage:e=>this._sendMessageToTab({...e.data,label:"conditions",id:t})},r=await(0,o.Z)(e.conditions,s);return{data:"",nextBlockId:this.getBlockConnections(t,r.isMatch?1:"fallback"),replacedValue:r?.replacedValue||{}}}},81624:(e,t,a)=>{"use strict";async function o({data:e,id:t}){try{let a=!1;if("stop-current"===e.type){if(e.throwError)throw new Error(e.errorMessage||"Workflow stopped manually");return{}}if(["stop-specific","stop-all"].includes(e.type)){const t=[],o="stop-specific"===e.type;this.engine.states.getAll.forEach((a=>{o&&!e.workflowsToStop.includes(a.workflowId)||t.push(a.id)}));for(const n of t)n===this.engine.id?a=!!o||!e.exceptCurrent:await this.engine.states.stop(n)}return a?{}:{data:"",nextBlockId:this.getBlockConnections(t)}}catch(e){throw e.data=e.data||{},console.error(e),e}}a.r(t),a.d(t,{default:()=>o})},58419:(e,t,a)=>{"use strict";a.d(t,{ZP:()=>d});var o=a(81843),n=a.n(o),i=a(64413),s=a(87360),r=a(41376);const l={table:"table",dataColumn:"table",dataColumns:"table"};function c(e,{data:t,regex:a,tagLen:o,modifyPath:r,checkExistence:d=!1,disableStringify:u=!1}){const p={list:{},value:e};return p.value=e.replace(a,(e=>{let a=e.slice(o,-o).trim();if(!a)return"";let h="",m=!1;const w=function(e){const t=/^\$\s*(\w+)\s*\((.*)\)/.exec(e.trim().replace(/\r?\n|\r/g,""));if(!t)return null;const{1:a,2:o}=t;return{name:a,params:o.split(/,(?=(?:[^'"\\"\\']*['"][^'"]*['"\\"\\'])*[^'"]*$)/).map((e=>e.trim().replace(/^['"]|['"]$/g,"")||""))}}(a),f=w&&t.functions[w.name];if(r&&!f&&(a=r(a)),f){const e=w.params.map((e=>{const{value:a,list:o}=c(e,{data:t,tagLen:1,regex:/\[(.*?)\]/});return Object.assign(p.list,o),(0,s.Rx)(a,a)}));h=f.apply({refData:t},e)}else{let{dataKey:o,path:s}=function(e,t){let[a,o]=e.split(/[@.](.+)/);if(a=l[a]??a,!o)return{dataKey:a,path:""};if("table"!==a){if("loopData"===a&&!o.endsWith(".$index")){const e=o.split(".");e.splice(1,0,"data"),o=e.join(".")}return{dataKey:a,path:o}}const[n,i]=o.split(/\.(.+)/);"$last"===n?o=`${t.table.length-1}.${i||""}`:i?("number"!=typeof+n||Number.isNaN(+n))&&(o=`0.${n}.${i}`):o=`0.${n}`;return o=o.replace(/\.$/,""),{dataKey:"table",path:o}}(a,t);if(o.startsWith("!")&&(m=!0,o=o.slice(1)),d)return n().has(t[o],s);h=n().get(t[o],s),void 0===h&&(h=e),"secrets"===o&&(h="string"!=typeof h?{}:i.Z.decrypt(h))}const b=u||"string"==typeof h&&!m?h:JSON.stringify(h);return p.list[e]=b?.slice(0,512)??b,b})),p}function d(e,t,a={}){if(!e||"string"!=typeof e)return"";const o={...t,functions:r.Z},n={},i=c(`${e}`,{data:o,tagLen:2,regex:/\{\{(.*?)\}\}/g,modifyPath:e=>{const{value:t,list:i}=c(e,{data:o,tagLen:1,regex:/\[(.*?)\]/g,...a,checkExistence:!1});return Object.assign(n,i),t},...a});return Object.assign(i.list,n),i}},87491:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});var o=a(72112),n=a(58419);const i=!1;async function s(e,t,a={}){if(!e||"string"!=typeof e)return"";if(!/\{\{(.*?)\}\}/.test(e))return{list:{},value:e};let s={};const r=e.startsWith("!!");if(r&&!i){const a=/(variables|table|secrets|loopData|workflow|googleSheets|globalData)@/g,n=e.replace(a,"$1.");s=await(0,o.k$)("blockExpression",{str:n,data:t})}else{let o=`${e}`;r&&(o=o.slice(2)),s=(0,n.ZP)(o,t,a)}return s}},41376:(e,t,a)=>{"use strict";a.d(t,{Z:()=>d});var o=a(11355),n=a.n(o),i=a(16483),s=a.n(i),r=a(97148),l=a.n(r);s().extend(l());const c=(...e)=>e.every((e=>!Number.isNaN(+e)));const d={date(...e){let t=new Date,a="DD-MM-YYYY";1===e.length?a=e[0]:e.length>=2&&(t=new Date(e[0]),a=e[1]);const o=t instanceof Date&&!isNaN(t),n=s()(o?t:Date.now());let i=n.format(a);return"relative"===a?i=n.fromNow():"timestamp"===a&&(i=n.valueOf()),i},randint:(e=0,t=100)=>Math.round(Math.random()*(+t-+e)+ +e),getLength(e){const t=function(e,t){try{return JSON.parse(e)}catch(e){return t}}(e,e);return t.length??t},slice(e,t,a){if(!e||!e.slice)return e;const o=Number.isNaN(+t)?0:+t,n=Number.isNaN(+a)?e.length:+a;return e.slice(o,n)},multiply:(e,t)=>c(e,t)?+e*+t:e,increment:(e,t)=>c(e,t)?+e+ +t:e,divide:(e,t)=>c(e,t)?+e/+t:e,subtract:(e,t)=>c(e,t)?+e-+t:e,randData(e){if(Array.isArray(e)){return e[Math.floor(Math.random()*e.length)]}const t=e=>e[Math.floor(Math.random()*e.length)],a="abcdefghijklmnopqrstuvwxyz",o="ABCDEFGHIJKLMNOPQRSTUVWXYZ",n=[0,1,2,3,4,5,6,7,8,9],i='!@#$%^&*()-_+={}[]|;:\'"<>,./?"',s={l:()=>t(a),u:()=>t(o),d:()=>t(n),s:()=>t(i),f(){return this.l()+this.u()},n(){return this.l()+this.d()},m(){return this.u()+this.d()},i(){return this.l()+this.u()+this.d()},a:()=>t(a+o+n.join("")+i)};return`${e}`.replace(/\?[a-zA-Z]/g,(e=>s[e.at(-1)]?.()??e))},filter(e,t){return"object"==typeof(a=e)&&null!==a&&!Array.isArray(a)||Array.isArray(e)?n().query(e,t):e;var a},replace:(e,t,a)=>e?e.replace(t,a):e,replaceAll:(e,t,a)=>e?e.replaceAll(t,a):e,toLowerCase:e=>e?e.toLowerCase():e,toUpperCase:e=>e?e.toUpperCase():e,modulo:(e,t)=>+e%+t,stringify:e=>JSON.stringify(e)}},76678:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});var o=a(96973),n=a(72112);const i=(0,o.k)("1234567890abcdef",5);async function s(e,t){const a=`automa${i()}`;if(!t.data.context||"website"===t.data.context||!t.isPopup){if(!e.id)throw new Error("no-tab");const o=(0,n.XB)(a),i=`\n      function() {\n        // \n        // \n        return \`\n        (async () => {\n          const automa${a} = ${JSON.stringify(t.refData)};\n          ${o}\n          try {\n            ${t.data.code}\n          } catch (error) {\n            return {\n              $isError: true,\n              message: error.message,\n            }\n          }\n        })();\n        \`;\n      }\n      `;return(await(0,n.uh)({target:{tabId:e.id},debugMode:t.debugMode},i)).value}const o=await(0,n.k$)("conditionCode",t);if(o&&o.$isError)throw new Error(o.message);return o}},13282:(e,t,a)=>{"use strict";a.d(t,{Z:()=>p});var o=a(92323),n=a.n(o),i=a(87360),s=a(57692),r=a(87491);const l=e=>"true"===e||"false"!==e&&e,c=e=>Number.isNaN(+e)?e:+e,d={eq:(e,t)=>e===t,eqi:(e,t)=>e?.toLocaleLowerCase()===t?.toLocaleLowerCase(),nq:(e,t)=>e!==t,gt:(e,t)=>c(e)>c(t),gte:(e,t)=>c(e)>=c(t),lt:(e,t)=>c(e)<c(t),lte:(e,t)=>c(e)<=c(t),cnt:(e,t)=>e?.includes(t)??!1,cni:(e,t)=>e?.toLocaleLowerCase().includes(t?.toLocaleLowerCase())??!1,nct:(e,t)=>!d.cnt(e,t),nci:(e,t)=>!d.cni(e,t),stw:(e,t)=>e?.startsWith(t)??!1,enw:(e,t)=>e?.endsWith(t)??!1,rgx:(e,t)=>{const a=t.match(/^\/(.*?)\/([gimy]*)$/);return(a?new RegExp(a[1],a[2]):new RegExp(t)).test(e)},itr:e=>Boolean(l(e)),ifl:e=>!l(e)},u={string:e=>`${e}`,number:e=>+e,json:e=>(0,i.Rx)(e,null),boolean:e=>Boolean(l(e))};async function p(e,t){const a={isMatch:!1,replacedValue:{}};async function o({type:e,data:o}){if(e.startsWith("data")){let e=o.dataPath.trim().replace("@",".");e.startsWith("{{")&&e.endsWith("}}")||(e=`{{${e}}}`);let a=await(0,r.Z)(e,t.refData,t.isPopup,{checkExistence:!0});return a=Boolean((0,i.Rx)(a.value,!1)),a}const s=n()(o);for(const e of Object.keys(o)){const{value:o,list:n}=await(0,r.Z)(s[e],t.refData,t.isPopup);s[e]=o??"",Object.assign(a.replacedValue,n)}if("value"===e){if(/^(json|string|number|boolean)::/.test(s.value)){const[e,t]=s.value.split(/::(.*)/s);return u[e](t)}return s.value}if(e.startsWith("code")){let a;const n={};return Object.keys(t.refData).forEach((e=>{s.code.includes(e)&&(n[e]=t.refData[e])})),a=t.isMV2&&"background"!==o.context?await t.sendMessage({type:"condition-builder",data:{type:e,data:s,refData:n}}):await t.checkCodeCondition({data:s,refData:n,isPopup:t.isPopup}),a}if(e.startsWith("element")){return await t.sendMessage({type:"condition-builder",data:{type:e,data:s}})}return""}async function l(e){let t=!0;const a={value:"",operator:""};for(const{category:n,data:i,type:r}of e){if(!t)return t;if("compare"===n){const{needValue:e}=s.YK.compareTypes.find((({id:e})=>e===r));if(!e)return t=d[r](a.value),t;a.operator=r}else if("value"===n){const e=await o({data:i,type:r}),{compareable:n}=s.YK.valueTypes.find((({id:e})=>e===r));n?a.operator&&(t=d[a.operator](a.value,e),a.operator=""):t=e,a.value=e}}return t}for(const{conditions:t}of e){if(a.isMatch)return a;let e=!1;for(const{items:a}of t)if(e=await l(a),!e)break;a.isMatch=e}return a}},34713:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});var o=a(67197),n=a(72112),i=a(87491);const s=class{static async#o({url:e,method:t,headers:a,body:o},n){if(!e.trim())return;const s={"Content-Type":"application/json"};a.forEach((e=>{s[e.name]=e.value}));const r="GET"!==t?(await(0,i.Z)(o,n)).value:void 0;await fetch(e,{method:t,body:r,headers:s})}static async#n(e,t){const a=`automa${(0,o.x0)()}`;await(0,n.k$)("javascriptBlock",{refData:t,instanceId:a,preloadScripts:[],blockData:{code:e.code}})}static async handle(e,t){switch(e.type){case"http-request":await this.#o(e,t);break;case"js-code":await this.#n(e,t)}}}},65577:(e,t,a)=>{var o={"./en/blocks.json":[92990,7194],"./en/common.json":[76074,5163],"./en/newtab.json":[37576,3835],"./en/popup.json":[52250,910],"./es/blocks.json":[92993,7606],"./es/common.json":[63312,1799],"./es/newtab.json":[69834,2826],"./es/popup.json":[9020,6140],"./fr/blocks.json":[10071,1531],"./fr/common.json":[79964,1719],"./fr/newtab.json":[69509,325],"./fr/popup.json":[86358,2366],"./it/blocks.json":[82544,4519],"./it/common.json":[24333,7654],"./it/newtab.json":[93540,4120],"./it/popup.json":[13952,7174],"./pt-BR/blocks.json":[16854,3282],"./pt-BR/common.json":[14678,3335],"./pt-BR/newtab.json":[35945,9800],"./pt-BR/popup.json":[49969,1167],"./tr/blocks.json":[82813,437],"./tr/common.json":[39276,2167],"./tr/newtab.json":[65846,7948],"./tr/popup.json":[57272,7919],"./uk/blocks.json":[7913,5587],"./uk/common.json":[1233,5660],"./uk/newtab.json":[43711,4433],"./uk/popup.json":[13178,3424],"./vi/blocks.json":[81379,1342],"./vi/common.json":[83244,1825],"./vi/newtab.json":[67249,6631],"./vi/popup.json":[43429,9030],"./zh-TW/blocks.json":[96670,2466],"./zh-TW/common.json":[47978,6652],"./zh-TW/newtab.json":[26317,1915],"./zh-TW/popup.json":[43636,612],"./zh/blocks.json":[48862,9639],"./zh/common.json":[32859,9381],"./zh/newtab.json":[38137,5601],"./zh/popup.json":[42398,9450]};function n(e){if(!a.o(o,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=o[e],n=t[0];return a.e(t[1]).then((()=>a(n)))}n.keys=()=>Object.keys(o),n.id=65577,e.exports=n},4606:(e,t,a)=>{var o={"./handlerActiveTab.js":2673,"./handlerAiWorkflow.js":22116,"./handlerBlockPackage.js":49279,"./handlerBlocksGroup.js":44220,"./handlerBrowserEvent.js":35362,"./handlerClipboard.js":83990,"./handlerCloseTab.js":53022,"./handlerConditions.js":92482,"./handlerCookie.js":16997,"./handlerCreateElement.js":290,"./handlerDataMapping.js":16476,"./handlerDelay.js":43883,"./handlerDeleteData.js":12801,"./handlerElementExists.js":23206,"./handlerExecuteWorkflow.js":4399,"./handlerExportData.js":5807,"./handlerForwardPage.js":27882,"./handlerGoBack.js":88857,"./handlerGoogleDrive.js":69067,"./handlerGoogleSheets.js":10849,"./handlerGoogleSheetsDrive.js":86718,"./handlerHandleDialog.js":2729,"./handlerHandleDownload.js":6794,"./handlerHoverElement.js":67057,"./handlerIncreaseVariable.js":67437,"./handlerInsertData.js":34002,"./handlerInteractionBlock.js":76539,"./handlerJavascriptCode.js":58285,"./handlerLink.js":11885,"./handlerLogData.js":91215,"./handlerLoopBreakpoint.js":84588,"./handlerLoopData.js":58006,"./handlerLoopElements.js":95277,"./handlerNewTab.js":53489,"./handlerNewWindow.js":86277,"./handlerNotification.js":49304,"./handlerParameterPrompt.js":95973,"./handlerProxy.js":75249,"./handlerRegexVariable.js":22743,"./handlerReloadTab.js":22654,"./handlerRepeatTask.js":45926,"./handlerSaveAssets.js":92160,"./handlerSliceVariable.js":73935,"./handlerSortData.js":68012,"./handlerSwitchTab.js":32821,"./handlerSwitchTo.js":2692,"./handlerTabUrl.js":57726,"./handlerTakeScreenshot.js":71103,"./handlerTrigger.js":20692,"./handlerWaitConnections.js":70980,"./handlerWebhook.js":50460,"./handlerWhileLoop.js":90997,"./handlerWorkflowState.js":81624};function n(e){var t=i(e);return a(t)}function i(e){if(!a.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}n.keys=function(){return Object.keys(o)},n.resolve=i,e.exports=n,n.id=4606},91054:()=>{}}]);